<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.86.0" />
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
<link rel="alternate" type="application/rss&#43;xml" href="https://brpc.incubator.apache.org/docs/server/serve-httph2/index.xml">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Serve http:h2 | bRPC</title><meta property="og:title" content="Serve http:h2" />
<meta property="og:description" content="Learn how to serve Http2.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://brpc.incubator.apache.org/docs/server/serve-httph2/" /><meta property="og:site_name" content="bRPC" />

<meta itemprop="name" content="Serve http:h2">
<meta itemprop="description" content="Learn how to serve Http2.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Serve http:h2"/>
<meta name="twitter:description" content="Learn how to serve Http2.
"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-93485976-3', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>




<link rel="preload" href="/scss/main.min.3ec220ee970bc505bab687924141abfe4d5e51807105a3b107b0cad6e3c0efc6.css" as="style">
<link href="/scss/main.min.3ec220ee970bc505bab687924141abfe4d5e51807105a3b107b0cad6e3c0efc6.css" rel="stylesheet" integrity="">


<script src="/js/jquery-3.3.1.min.js"></script>





    <title>Serve http:h2 | bRPC</title>
  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"><svg width="303" height="259" viewBox="0 0 303 259" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>brpc_logo.svg</title><defs><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-1"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-2"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-3"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-4"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient></defs><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><circle id="椭圆形" fill="#58b8ff" cx="23.5" cy="62.5" r="23.5"/><circle id="椭圆形" fill="#58b8ff" cx="279.5" cy="60.5" r="23.5"/><circle id="椭圆形" fill="#58b8ff" cx="119" cy="26" r="26"/><rect id="矩形" fill="#58b8ff" transform="translate(78.021813, 41.967662) rotate(-22.000000) translate(-78.021813, -41.967662)" x="30.0218125" y="35.9676616" width="96" height="12"/><rect id="矩形" fill="#58b8ff" transform="translate(201.451088, 44.299021) rotate(13.000000) translate(-201.451088, -44.299021)" x="138.951088" y="38.2990214" width="125" height="12"/><g id="brpc-logo" transform="translate(11.000000, 104.000000)" fill-rule="nonzero"><g id="编组" transform="translate(138.000000, 77.419111) scale(-1, 1) rotate(-180.000000) translate(-138.000000, -77.419111) translate(0.000000, 0.000000)"><path d="M18.8 154.3C17.8 154.1 17 153.8 17 153.6 17 153.5 13.2 134.3 8.5 111 3.8 87.7-205355861e-22 68-205355861e-22 67.4-205355861e-22 65.9 2.6 65.3 5.7 65.8 7.3 66.1 8.1 67.2 8.6 69.6 9.3 73.5 10 73.8 11.7 71.1 15 65.9 28.8 63.2 36.4 66.4 48.9 71.6 57.7 89.6 56.8 108.1c-.5 10-2.5 14.5-7.8 17.1C44.5 127.5 36.6 127.5 31.4 125.1 27 123.1 20.8814242 116.827994 20 115.8 19.8268414 115.598047 19.5 115 19 115.2 18.3 115.4 18.3 116.5 19 118.7 19.6 120.4 21.6 129 23.4 137.8l3.3 16L24.6 154.4C22.3 155 21.4 155 18.8 154.3zm24.6146505-36.885789c1.7578246-1.326292 2.0864078-1.825452 2.4530432-2.642066S46.8138702 112.705545 47.1008328 111.513935C48.333925 109.104457 47.0101697 95.2413285 45.0724535 89.7736686 41.197021 79.2090375 34.9434822 73 28.2495534 73c-4.5800565.0-7.4866309 1.5754274-11.5382193 6.1163653-1.6734822 1.8534441-1.598743 2.8514069-2.0391331 4.4738936C14.2318109 85.2127457 15.3810952 94.5991493 17.4068894 98.6767262 18.5085881 100.995054 18.5085881 100.995054 20.3179492 104.427606 20.9381193 105.604136 23.3268821 108.69306 24.5063492 109.790864c1.2349847 1.149478 2.6574201 2.834639 3.7432042 3.921533 1.1506404 1.15181600000001 4.2465085 3.084017 5.3028342 3.701814 1.4321645.837608000000003 2.774919 1.362015 4.0282636 1.573221C40.1349135 119.080104 41.2462694 118.670624 43.4146505 117.414211z" id="形状" fill="url(#linearGradient-1)"/><path d="M248.7 148.9C241 147.8 232.2 143 226.1 136.5c-14.2-15-20-43.1-12.1-58.6C216.6 72.9 223.2 67.5 228.5 66 235.2 64.1 249.3 65.1 255.7 67.9 258.6 69.2 261.4 70.8 262.1 71.6 263.7 73.5 265 79.9 263.9 80.6 263.4 80.9 260 79.6 256.3 77.8 243 71.3 230.4 73.3 225.1 82.9 218.5 94.9 223.7 119.3 235.5 131.5 245.8 142 257.4 142.9 271.3 134.2 273.7 132.7 274.2 132.7 275 134 275.5 134.8 276 137.2 276 139.2 276 142.2 275.5 143.2 272.8 144.8 266.2 148.7 257.7 150.2 248.7 148.9z" id="路径" fill="#fff"/><path d="M87.4 148.1C86.2 147.6 84.9 146.7 84.6 146.1 83.6 144.5 68.1 66.6 68.7 65.8c.599999999999994-1 7.5-1 9 0C78.4 66.3 80.6 74.4 82.5 83.9s3.7 17.6 4 18.2C87.5 103.6 96.3 103.1 99.9 101.2 105.7 98.3 107.2 95.2 110 79.7l2.5-14.2L117.3 65.2C123.5 64.8 123.7 65.7 121.6 78.4c-2.5 14.4-4.5 21.2-7.3 24.2C113 104 112 105.3 112.2 105.5 112.4 105.6 114.3 106.7 116.5 107.8 124.5 111.9 129.8 119.6 130.7 128.5 131.7 138 127.9 143.9 119 146.9 114.5 148.4 90.2 149.3 87.4 148.1zm24.9-9.5C117.8 136.3 119.3 133.8 118.8 127.7 117.9 117 111.3 112.1 96.6 111.2L87.7 110.7 88.3 113.1C88.6 114.4 89.8 120.5 91 126.5 92.1 132.6 93.3 138.1 93.5 138.8 94.1 140.5 108.1 140.4 112.3 138.6z" id="形状" fill="#fff"/><path d="M159.5 148.4C158.4 148.1 157.2 147.5 156.7 147.1c-1-1-16.8-80.2-16.1-81.2C141.2 64.8 148 64.7 149.7 65.8 150.3 66.2 152.2 73.3 153.8 81.5L156.7 96.5 167.8 97.1c17.1 1 25.5 5.7 31.2 17.2C206.2 129.1 202.4 143.6 190.5 146.9 186.1 148.1 162.6 149.2 159.5 148.4zm27.2-11C195 131.2 191.3 114.2 180.5 108.6 177.6 107.1 174.2 106.4 167.8 106.2 162.9 106 159 106.2 159 106.7 159 107.1 160.4 114.9 162.1 123.9L165.3 140.2 174.6 139.8C182.1 139.5 184.5 139 186.7 137.4z" id="形状" fill="#fff"/><path d="M52.3 50.7C49 41.2 49.5 37.5 52.9 46.5c1.2 3.1 1.9876864 5.9098389 2.1 6.3S55.4 54.1 55.9 54.9C56.6 56 58.2 55.2 63.5 50.9 67.2 47.9 70.4 45.6 70.6 45.8 71.7 46.5 70.9 47.4 64.1 53.2 60 56.6 58.2983882 57.6981689 57.4 58.2 56.5016118 58.7018311 56.5016118 58.7018311 55.8 58.2 55 57.49737 54 55.4 52.3 50.7z" id="形状" fill="#7e7e7e"/><path d="M84 34.1C84 30.6 82.8 29 80.4 29 78.9 29 78 28.4 78 27.5 78 26.7 78.9 26 80 26 82.4 26 82.4 25.5 80.5 17 79.7 13.4 79.1 8.4 79 5.8 79 1.6 79.3 1 81.4.4 85.1-.5 89.5.3 89.8 2 90 3.1 89.2 3.5 86.8 3.5 83.9 3.5 83.5 3.8 83.3 6.5 83.1 8.2 83.8 13.1 84.8 17.5c1.7 7.9 1.7 8 5.2 8.6L93.5 26.7C94.2848943 26.7875501 94.751561 26.9875501 94.9 27.3 95 28.6 94.2 29 91.1 29h-4L87.7 32.5C88.2 35.6 88 36 86.1 36 84.7 36 84 35.4 84 34.1z" id="形状" fill="url(#linearGradient-2)"/><path d="M105 34.1C105 30.6 103.8 29 101.4 29 99.9 29 99 28.4 99 27.5 99 26.7 99.9 26 101 26 103.4 26 103.4 25.5 101.5 17 100.7 13.4 100.1 8.4 1e2 5.8 1e2 1.6 100.3 1 102.4.4 106.1-.5 110.5.3 110.8 2 111 3.1 110.2 3.5 107.8 3.5 104.9 3.5 104.5 3.8 104.3 6.5 104.1 8.2 104.8 13.1 105.8 17.5c1.7 7.9 1.7 8 5.2 8.6L114.5 26.7C115.433333 26.8462934 115.9 27.0462934 115.9 27.3 116 28.6 115.2 29 112.1 29h-4L108.7 32.5C109.2 35.6 109 36 107.1 36 105.7 36 105 35.4 105 34.1z" id="形状" fill="url(#linearGradient-2)"/><path d="M54.3 26.9c-4.5-2.9-7.7-10-7.8-17.2C46.5 1.9 48.6.0 57.2.0 63.6.0 67 1.2 67 3.6 67 4.7 66.6 4.8 65.1 4c-2.7-1.4-10.4-1.3-12.4.3C51.8 4.9 51 6.6 50.9 8 50.4 13.5 50.6 13.7 57.8 14.2 66 14.9 69.5 16.4 71 20 72.3 23.2 71.2 26.3 68 28s-10.2 1.1-13.7-1.1zM67 22.7C67 19 63.6 17 57.3 17 54.4 17 52 17.3 52 17.8c0 1.1 3.1 5.4 5 7C57.9 25.5 60.2 25.9 62.8 25.7 65.1 25.4 67 26.1 67 22.7z" id="形状" fill="url(#linearGradient-3)"/><path d="M126.3 26.9c-4.5-2.9-7.7-10-7.8-17.2C118.5 1.9 120.6.0 129.2.0 135.6.0 139 1.2 139 3.6 139 4.7 138.6 4.8 137.1 4 134.4 2.6 126.7 2.7 124.7 4.3 123.8 4.9 123 6.6 122.9 8 122.4 13.5 122.6 13.7 129.8 14.2 138 14.9 141.5 16.4 143 20 144.3 23.2 143.2 26.3 140 28s-10.2 1.1-13.7-1.1zM139 22.7C139 19 135.6 17 129.3 17 126.4 17 124 17.3 124 17.8 124 18.9 127.1 23.2 129 24.8 129.9 25.5 132.2 25.9 134.8 25.7 137.1 25.4 139 26.1 139 22.7z" id="形状" fill="url(#linearGradient-3)"/><path d="M153.7 26.8C151.7 18.4 149.2978 2.90464869 149.2978 2.1 149.2978 1.77371339 148.894918.241544332 150.3.1 151.705082-.0415443324 153 .4 153 2.1 153 3.2 153.7 7.2 154.6 11 156.5 19.3 161 25.2 165.5 25.4 167.5 25.5 168.6 26.1 168.8 27.3 169.1 28.6 168.4 29 165.8 29 163.2 29 161.6 28.2 159.4 25.8L156.5 22.5C155.5 19.6333333 155.133333 18.4333333 155.4 18.9 155.9 19.7 156.5 22.2 156.7 24.6 156.9 27.9 156.7 29 155.6 29 154.8 29 154 28 153.7 26.8z" id="形状" fill="url(#linearGradient-4)"/></g></g></g></svg></span>
        
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="https://github.com/apache/incubator-brpc/" target="_blank" ><span>GitHub</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/" ><span class="active">Docs</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/docs/blogs/" ><span>Blog</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/docs/community/community/" ><span>Community</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/docs/faq/" ><span>FAQ</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				<a class="nav-link" href="/docs/users/" ><span>Users</span></a>
			</li>
			
			
			
			<li class="nav-item dropdown d-none d-lg-block">
				

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	English
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/zh/docs/server/serve-httph2/">中文</a>
	
</div>
			</li>
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            




<div id="td-sidebar-menu" class="td-sidebar__inner">
  
  <form class="td-sidebar__search d-flex align-items-center">
    
<input type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">

    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type="button" data-toggle="collapse" data-target="#td-section-nav" aria-controls="td-docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  
  <nav class="collapse td-sidebar-nav pt-2 pl-4" id="td-section-nav">
    
    <div class="nav-item dropdown d-block d-lg-none">
      

<a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
	English
</a>
<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
	
	<a class="dropdown-item" href="/zh/docs/server/serve-httph2/">中文</a>
	
</div>
    </div>
    
    






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Docs</a>
  </li>
  <ul>
    <li class="collapse show" id="docs">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsoverview" href="/docs/overview/">Overview</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsgetting_started" href="/docs/getting_started/">Getting started</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsbenchmark" href="/docs/benchmark/">Performance benchmark</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bvar/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bvar</a>
  </li>
  <ul>
    <li class="collapse " id="docsbvar">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bvar/bvar/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bvar</a>
  </li>
  <ul>
    <li class="collapse " id="docsbvarbvar">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bvar/bvar-c&#43;&#43;/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bvar c&#43;&#43;</a>
  </li>
  <ul>
    <li class="collapse " id="docsbvarbvar-c">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bthread/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread</a>
  </li>
  <ul>
    <li class="collapse " id="docsbthread">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bthread/bthread/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread</a>
  </li>
  <ul>
    <li class="collapse " id="docsbthreadbthread">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bthread/bthread-or-not/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread or not</a>
  </li>
  <ul>
    <li class="collapse " id="docsbthreadbthread-or-not">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bthread/execution-queue/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Execution Queue</a>
  </li>
  <ul>
    <li class="collapse " id="docsbthreadexecution-queue">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/bthread/thread-local/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">thread-local</a>
  </li>
  <ul>
    <li class="collapse " id="docsbthreadthread-local">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Client</a>
  </li>
  <ul>
    <li class="collapse " id="docsclient">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/basics/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Basics</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientbasics">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/error-code/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Error code</a>
  </li>
  <ul>
    <li class="collapse " id="docsclienterror-code">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/combo-channels/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Combo channels</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientcombo-channels">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/access-httph2/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Access http:h2</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientaccess-httph2">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/access-grpc/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Access gRPC</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientaccess-grpc">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/access-thrift/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Access thrift</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientaccess-thrift">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/access-ub/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Access UB</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientaccess-ub">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/access-redis/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Access redis</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientaccess-redis">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/access-memcached/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Access memcached</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientaccess-memcached">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/streaming-rpc/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Streaming RPC</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientstreaming-rpc">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/backup-request/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Backup request</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientbackup-request">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/client/dummy-server/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Dummy server</a>
  </li>
  <ul>
    <li class="collapse " id="docsclientdummy-server">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/" class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">Server</a>
  </li>
  <ul>
    <li class="collapse show" id="docsserver">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/basics/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Basics</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverbasics">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/serve-httph2/" class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">Serve http:h2</a>
  </li>
  <ul>
    <li class="collapse show" id="docsserverserve-httph2">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/serve-grpc/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Serve gRPC</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverserve-grpc">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/serve-thrift/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Serve thrift</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverserve-thrift">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/serve-nshead/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Serve Nshead</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverserve-nshead">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/server-push/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Server push</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverserver-push">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/avalanche/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Avalanche</a>
  </li>
  <ul>
    <li class="collapse " id="docsserveravalanche">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/debug-server-issues/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Debug server issues</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverdebug-server-issues">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/auto-concurrencylimiter/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Auto ConcurrencyLimiter</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverauto-concurrencylimiter">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/media-server/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Media Server</a>
  </li>
  <ul>
    <li class="collapse " id="docsservermedia-server">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/server/json2pb/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">json2pb</a>
  </li>
  <ul>
    <li class="collapse " id="docsserverjson2pb">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Builtin Services</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-services">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/buildin_services/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">builtin services</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicesbuildin_services">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/status/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">status</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicesstatus">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/vars/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">vars</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicesvars">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/connections/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">connections</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicesconnections">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/flags/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">flags</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicesflags">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/rpcz/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpcz</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicesrpcz">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/cpu_profiler/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">cpu profiler</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicescpu_profiler">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/heap_profiler/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">heap profiler</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicesheap_profiler">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/builtin-services/contention_profiler/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">contention profiler</a>
  </li>
  <ul>
    <li class="collapse " id="docsbuiltin-servicescontention_profiler">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tools/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Tools</a>
  </li>
  <ul>
    <li class="collapse " id="docstools">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tools/rpc_press/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpc_press</a>
  </li>
  <ul>
    <li class="collapse " id="docstoolsrpc_press">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tools/rpc_replay/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpc_replay</a>
  </li>
  <ul>
    <li class="collapse " id="docstoolsrpc_replay">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tools/rpc_view/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpc_view</a>
  </li>
  <ul>
    <li class="collapse " id="docstoolsrpc_view">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tools/benchmark_http/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">benchmark_http</a>
  </li>
  <ul>
    <li class="collapse " id="docstoolsbenchmark_http">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/tools/parallel_http/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">parallel_http</a>
  </li>
  <ul>
    <li class="collapse " id="docstoolsparallel_http">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/c&#43;&#43;-base/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">C&#43;&#43; Base</a>
  </li>
  <ul>
    <li class="collapse " id="docsc-base">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/c&#43;&#43;-base/iobuf/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">IOBuf</a>
  </li>
  <ul>
    <li class="collapse " id="docsc-baseiobuf">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/c&#43;&#43;-base/streaming-log/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Streaming Log</a>
  </li>
  <ul>
    <li class="collapse " id="docsc-basestreaming-log">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/c&#43;&#43;-base/flatmap/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">FlatMap</a>
  </li>
  <ul>
    <li class="collapse " id="docsc-baseflatmap">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/c&#43;&#43;-base/brpc-training-materials/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bRPC Training Materials</a>
  </li>
  <ul>
    <li class="collapse " id="docsc-basebrpc-training-materials">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">RPC in depth</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depth">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/new-protocol/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">New Protocol</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthnew-protocol">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/atomic-instructions/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Atomic instructions</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthatomic-instructions">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/io/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">IO</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthio">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/threading-overview/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Threading Overview</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depththreading-overview">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/load-balancing/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Load Balancing</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthload-balancing">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/locality-aware/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Locality-aware</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthlocality-aware">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/consistent-hashing/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Consistent Hashing</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthconsistent-hashing">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/memory-management/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Memory Management</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthmemory-management">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/timer-keeping/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Timer keeping</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthtimer-keeping">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/rpc-in-depth/bthread_id/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread_id</a>
  </li>
  <ul>
    <li class="collapse " id="docsrpc-in-depthbthread_id">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/use-cases-inside-baidu/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Use cases inside Baidu</a>
  </li>
  <ul>
    <li class="collapse " id="docsuse-cases-inside-baidu">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/use-cases-inside-baidu/use-case1/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">百度地图api入口</a>
  </li>
  <ul>
    <li class="collapse " id="docsuse-cases-inside-baiduuse-case1">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/use-cases-inside-baidu/use-case2/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">联盟DSP</a>
  </li>
  <ul>
    <li class="collapse " id="docsuse-cases-inside-baiduuse-case2">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/use-cases-inside-baidu/use-case3/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ELF学习框架</a>
  </li>
  <ul>
    <li class="collapse " id="docsuse-cases-inside-baiduuse-case3">
      
      
      
    </li>
  </ul>
</ul>

      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/use-cases-inside-baidu/use-case4/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">云平台代理服务</a>
  </li>
  <ul>
    <li class="collapse " id="docsuse-cases-inside-baiduuse-case4">
      
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsdownloadbrpc" href="/docs/downloadbrpc/">Download bRPC</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/community/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Community</a>
  </li>
  <ul>
    <li class="collapse " id="docscommunity">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscommunitycommunity" href="/docs/community/community/">Community</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscommunitysecurity" href="/docs/community/security/">Security</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docscommunitycommitter" href="/docs/community/committer/">Committer Guide</a>
      
      
    </li>
  </ul>
</ul>

      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsfaq" href="/docs/faq/">FAQ</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsusers" href="/docs/users/">Users</a>
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/blogs/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Blog</a>
  </li>
  <ul>
    <li class="collapse " id="docsblogs">
      
      
      
      
      






<ul class="td-sidebar-nav__section pr-md-3">
  <li class="td-sidebar-nav__section-title">
    <a  href="/docs/blogs/releases/" class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Release</a>
  </li>
  <ul>
    <li class="collapse " id="docsblogsreleases">
      
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsblogsreleases110" href="/docs/blogs/releases/1.1.0/">bRPC 1.1.0</a>
      
      
      
      
      
      <a class="td-sidebar-link td-sidebar-link__page " id="m-docsblogsreleases100" href="/docs/blogs/releases/1.0.0/">bRPC 1.0.0</a>
      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

      
      
    </li>
  </ul>
</ul>

  </nav>
</div>




          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">





<a href="https://github.com/apache/incubator-brpc-website/edit/master/content/en/docs/Server/Serve%20http:h2/_index.md" target="_blank"><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/apache/incubator-brpc-website/issues/new?title=Serve%20http:h2" target="_blank"><i class="fab fa-github fa-fw"></i> Create documentation issue</a>


<a href="https://github.com/apache/incubator-brpc/issues/new" target="_blank"><i class="fas fa-tasks fa-fw"></i> Create project issue</a>

</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#servicenamemethodname-as-the-prefix">/ServiceName/MethodName as the prefix</a></li>
    <li><a href="#servicename-as-the-prefix">/ServiceName as the prefix</a></li>
    <li><a href="#restful-url">Restful URL</a></li>
  </ul>

  <ul>
    <li><a href="#http-headers">HTTP headers</a></li>
    <li><a href="#content-type">Content-Type</a></li>
    <li><a href="#status-code">Status Code</a></li>
    <li><a href="#query-string">Query String</a></li>
  </ul>

  <ul>
    <li>
      <ul>
        <li><a href="#q-the-nginx-before-brpc-encounters-final-fail">Q: The nginx before brpc encounters final fail</a></li>
        <li><a href="#q-does-brpc-support-http-chunked-mode">Q: Does brpc support http chunked mode</a></li>
        <li><a href="#q-why-do-http-requests-containing-base64-encoded-query-string-fail-to-parse-sometimes">Q: Why do HTTP requests containing BASE64 encoded query string fail to parse sometimes?</a></li>
      </ul>
    </li>
  </ul>
</nav>



          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            <nav aria-label="breadcrumb" class="d-none d-md-block d-print-none">
	<ol class="breadcrumb spb-1">
		










<li class="breadcrumb-item" >
	<a href="/docs/">Docs</a>
</li>




<li class="breadcrumb-item" >
	<a href="/docs/server/">Server</a>
</li>




<li class="breadcrumb-item active" aria-current="page">
	<a href="/docs/server/serve-httph2/">Serve http:h2</a>
</li>

	</ol>
</nav	>


            
<div class="td-content">
	<h1>Serve http:h2</h1>
	<div class="lead">Learn how to serve Http2.</div>
	<p>This document talks about ordinary htt/h2 services rather than protobuf services accessible via http/h2.
http/h2 services in brpc have to declare interfaces with empty request and response in a .proto file. This requirement keeps all service declarations inside proto files rather than scattering in code, configurations, and proto files.</p>
<h1 id="example">Example</h1>
<p><a href="https://github.com/brpc/brpc/blob/master/example/http_c++/http_server.cpp">http_server.cpp</a></p>
<h1 id="about-h2">About h2</h1>
<p>brpc names the HTTP/2 protocol to &ldquo;h2&rdquo;, no matter encrypted or not. However HTTP/2 connections without SSL are shown on /connections with the official name &ldquo;h2c&rdquo;, and the ones with SSL are shown as &ldquo;h2&rdquo;.</p>
<p>The APIs for http and h2 in brpc are basically same. Without explicit statement, mentioned http features work for h2 as well.</p>
<h1 id="url-types">URL types</h1>
<h2 id="servicenamemethodname-as-the-prefix">/ServiceName/MethodName as the prefix</h2>
<p>Define a service named <code>ServiceName</code>(not including the package name), with a method named <code>MethodName</code> and empty request/response, the service will provide http/h2 service on <code>/ServiceName/MethodName</code> by default.</p>
<p>The reason that request and response can be empty is that all data are in Controller:</p>
<ul>
<li>Header of the http/h2 request is in Controller.http_request() and the body is in Controller.request_attachment().</li>
<li>Header of the http/h2 response is in Controller.http_response() and the body is in Controller.response_attachment().</li>
</ul>
<p>Implementation steps:</p>
<ol>
<li>Add the service declaration in a proto file.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#204a87;font-weight:bold">option</span> <span style="color:#000">cc_generic_services</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span><span style="color:#a40000"></span> <span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">HttpRequest</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">};</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">HttpResponse</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">};</span><span style="color:#a40000">
</span><span style="color:#a40000"></span> <span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">service</span> <span style="color:#000">HttpService</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span><span style="color:#a40000"></span>      <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">Echo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#000;font-weight:bold">};</span><span style="color:#a40000">
</span></code></pre></div><ol start="2">
<li>Implement the service by inheriting the base class generated in .pb.h, which is same as protobuf services.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">HttpServiceImpl</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">HttpService</span> <span style="color:#000;font-weight:bold">{</span>
<span style="color:#204a87;font-weight:bold">public</span><span style="color:#ce5c00;font-weight:bold">:</span>
    <span style="color:#000;font-weight:bold">...</span>
    <span style="color:#204a87;font-weight:bold">virtual</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">Echo</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">google</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">protobuf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">RpcController</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">cntl_base</span><span style="color:#000;font-weight:bold">,</span>
                      <span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">HttpRequest</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#8f5902;font-style:italic">/*request*/</span><span style="color:#000;font-weight:bold">,</span>
                      <span style="color:#000">HttpResponse</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#8f5902;font-style:italic">/*response*/</span><span style="color:#000;font-weight:bold">,</span>
                      <span style="color:#000">google</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">protobuf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Closure</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">done</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ClosureGuard</span> <span style="color:#000">done_guard</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">done</span><span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Controller</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">cntl</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">static_cast</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Controller</span><span style="color:#ce5c00;font-weight:bold">*&gt;</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cntl_base</span><span style="color:#000;font-weight:bold">);</span>
 
        <span style="color:#8f5902;font-style:italic">// body is plain text
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">set_content_type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;text/plain&#34;</span><span style="color:#000;font-weight:bold">);</span>
       
        <span style="color:#8f5902;font-style:italic">// Use printed query string and body as the response.
</span><span style="color:#8f5902;font-style:italic"></span>        <span style="color:#000">butil</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">IOBufBuilder</span> <span style="color:#000">os</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000">os</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;queries:&#34;</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">URI</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">QueryIterator</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">uri</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">QueryBegin</span><span style="color:#000;font-weight:bold">();</span>
                <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">uri</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">QueryEnd</span><span style="color:#000;font-weight:bold">();</span> <span style="color:#ce5c00;font-weight:bold">++</span><span style="color:#000">it</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
            <span style="color:#000">os</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#39; &#39;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">it</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">first</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#39;=&#39;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">it</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">second</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000;font-weight:bold">}</span>
        <span style="color:#000">os</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">body: &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">request_attachment</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#39;\n&#39;</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#000">os</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">move_to</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">response_attachment</span><span style="color:#000;font-weight:bold">());</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">};</span>
</code></pre></div><ol start="3">
<li>After adding the implemented instance into the server, the service is accessible via following URLs (Note that the path after <code>/HttpService/Echo </code> is filled into <code>cntl-&gt;http_request().unresolved_path()</code>, which is always normalized):</li>
</ol>
<table>
<thead>
<tr>
<th>URL</th>
<th>Protobuf Method</th>
<th>cntl-&gt;http_request().uri().path()</th>
<th>cntl-&gt;http_request().unresolved_path()</th>
</tr>
</thead>
<tbody>
<tr>
<td>/HttpService/Echo</td>
<td>HttpService.Echo</td>
<td>&ldquo;/HttpService/Echo&rdquo;</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>/HttpService/Echo/Foo</td>
<td>HttpService.Echo</td>
<td>&ldquo;/HttpService/Echo/Foo&rdquo;</td>
<td>&ldquo;Foo&rdquo;</td>
</tr>
<tr>
<td>/HttpService/Echo/Foo/Bar</td>
<td>HttpService.Echo</td>
<td>&ldquo;/HttpService/Echo/Foo/Bar&rdquo;</td>
<td>&ldquo;Foo/Bar&rdquo;</td>
</tr>
<tr>
<td>/HttpService//Echo///Foo//</td>
<td>HttpService.Echo</td>
<td>&ldquo;/HttpService//Echo///Foo//&rdquo;</td>
<td>&ldquo;Foo&rdquo;</td>
</tr>
<tr>
<td>/HttpService</td>
<td>No such method</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="servicename-as-the-prefix">/ServiceName as the prefix</h2>
<p>http/h2 services for managing resources may need this kind of URL, such as <code>/FileService/foobar.txt</code> represents <code>./foobar.txt</code> and <code>/FileService/app/data/boot.cfg</code> represents <code>./app/data/boot.cfg</code>.</p>
<p>Implementation steps:</p>
<ol>
<li>Use <code>FileService</code> as the service name and <code>default_method</code> as the method name in the proto file.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#204a87;font-weight:bold">option</span> <span style="color:#000">cc_generic_services</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">;</span><span style="color:#a40000">
</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">HttpRequest</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">};</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">message</span> <span style="color:#000">HttpResponse</span> <span style="color:#000;font-weight:bold">{</span> <span style="color:#000;font-weight:bold">};</span><span style="color:#a40000">
</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#204a87;font-weight:bold">service</span> <span style="color:#000">FileService</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span><span style="color:#a40000"></span>      <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">default_method</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#000;font-weight:bold">}</span><span style="color:#a40000">
</span></code></pre></div><ol start="2">
<li>Implement the service.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">FileServiceImpl</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#204a87;font-weight:bold">public</span> <span style="color:#000">FileService</span> <span style="color:#000;font-weight:bold">{</span>
<span style="color:#204a87;font-weight:bold">public</span><span style="color:#ce5c00;font-weight:bold">:</span>
    <span style="color:#000;font-weight:bold">...</span>
    <span style="color:#204a87;font-weight:bold">virtual</span> <span style="color:#204a87;font-weight:bold">void</span> <span style="color:#000">default_method</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">google</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">protobuf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">RpcController</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">cntl_base</span><span style="color:#000;font-weight:bold">,</span>
                                <span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">HttpRequest</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#8f5902;font-style:italic">/*request*/</span><span style="color:#000;font-weight:bold">,</span>
                                <span style="color:#000">HttpResponse</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#8f5902;font-style:italic">/*response*/</span><span style="color:#000;font-weight:bold">,</span>
                                <span style="color:#000">google</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">protobuf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Closure</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">done</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ClosureGuard</span> <span style="color:#000">done_guard</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">done</span><span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Controller</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">cntl</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">static_cast</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Controller</span><span style="color:#ce5c00;font-weight:bold">*&gt;</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cntl_base</span><span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">response_attachment</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Getting file: &#34;</span><span style="color:#000;font-weight:bold">);</span>
        <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">response_attachment</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">unresolved_path</span><span style="color:#000;font-weight:bold">());</span>
    <span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">};</span>
</code></pre></div><ol start="3">
<li>After adding the implemented instance into the server, the service is accessible via following URLs (the path after <code>/FileService</code> is filled in <code>cntl-&gt;http_request().unresolved_path()</code>, which is always normalized):</li>
</ol>
<table>
<thead>
<tr>
<th>URL</th>
<th>Protobuf Method</th>
<th>cntl-&gt;http_request().uri().path()</th>
<th>cntl-&gt;http_request().unresolved_path()</th>
</tr>
</thead>
<tbody>
<tr>
<td>/FileService</td>
<td>FileService.default_method</td>
<td>&ldquo;/FileService&rdquo;</td>
<td>&quot;&quot;</td>
</tr>
<tr>
<td>/FileService/123.txt</td>
<td>FileService.default_method</td>
<td>&ldquo;/FileService/123.txt&rdquo;</td>
<td>&ldquo;123.txt&rdquo;</td>
</tr>
<tr>
<td>/FileService/mydir/123.txt</td>
<td>FileService.default_method</td>
<td>&ldquo;/FileService/mydir/123.txt&rdquo;</td>
<td>&ldquo;mydir/123.txt&rdquo;</td>
</tr>
<tr>
<td>/FileService//mydir///123.txt//</td>
<td>FileService.default_method</td>
<td>&ldquo;/FileService//mydir///123.txt//&rdquo;</td>
<td>&ldquo;mydir/123.txt&rdquo;</td>
</tr>
</tbody>
</table>
<h2 id="restful-url">Restful URL</h2>
<p>brpc supports specifying a URL for each method in a service. The API is as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#8f5902;font-style:italic">// If `restful_mappings&#39; is non-empty, the method in service can
</span><span style="color:#8f5902;font-style:italic">// be accessed by the specified URL rather than /ServiceName/MethodName.
</span><span style="color:#8f5902;font-style:italic">// Mapping rules: &#34;PATH1 =&gt; NAME1, PATH2 =&gt; NAME2 ...&#34;
</span><span style="color:#8f5902;font-style:italic">// where `PATH&#39; is a valid path and `NAME&#39; is the method name.
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">int</span> <span style="color:#000">AddService</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">google</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">protobuf</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">Service</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">service</span><span style="color:#000;font-weight:bold">,</span>
               <span style="color:#000">ServiceOwnership</span> <span style="color:#000">ownership</span><span style="color:#000;font-weight:bold">,</span>
               <span style="color:#000">butil</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">StringPiece</span> <span style="color:#000">restful_mappings</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><p><code>QueueService</code> defined below contains several methods. If the service is added into the server normally, it&rsquo;s accessible via URLs like <code>/QueueService/start</code> and <code> /QueueService/stop</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-protobuf" data-lang="protobuf"><span style="color:#204a87;font-weight:bold">service</span> <span style="color:#000">QueueService</span> <span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">
</span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">start</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">stop</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">get_stats</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span><span style="color:#a40000"></span>    <span style="color:#204a87;font-weight:bold">rpc</span> <span style="color:#000">download_data</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpRequest</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">returns</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">HttpResponse</span><span style="color:#000;font-weight:bold">);</span><span style="color:#a40000">
</span><span style="color:#a40000"></span><span style="color:#000;font-weight:bold">};</span><span style="color:#a40000">
</span></code></pre></div><p>By specifying the 3rd parameter <code>restful_mappings</code> to <code>AddService</code>, the URL can be customized:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">server</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AddService</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">queue_svc</span><span style="color:#000;font-weight:bold">,</span>
                      <span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">SERVER_DOESNT_OWN_SERVICE</span><span style="color:#000;font-weight:bold">,</span>
                      <span style="color:#4e9a06">&#34;/v1/queue/start   =&gt; start,&#34;</span>
                      <span style="color:#4e9a06">&#34;/v1/queue/stop    =&gt; stop,&#34;</span>
                      <span style="color:#4e9a06">&#34;/v1/queue/stats/* =&gt; get_stats&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">LOG</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ERROR</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;Fail to add queue_svc&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
 
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">server</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AddService</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">queue_svc</span><span style="color:#000;font-weight:bold">,</span>
                      <span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">SERVER_DOESNT_OWN_SERVICE</span><span style="color:#000;font-weight:bold">,</span>
                      <span style="color:#4e9a06">&#34;/v1/*/start   =&gt; start,&#34;</span>
                      <span style="color:#4e9a06">&#34;/v1/*/stop    =&gt; stop,&#34;</span>
                      <span style="color:#4e9a06">&#34;*.data        =&gt; download_data&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">LOG</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ERROR</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;Fail to add queue_svc&#34;</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
</code></pre></div><p>There are 3 mappings separated by comma in the 3rd parameter (which is a string spanning 3 lines) to the <code>AddService</code>. Each mapping tells brpc to call the method at right side of the arrow if the left side matches the URL. The asterisk in <code>/v1/queue/stats/*</code> matches any string.</p>
<p>More about mapping rules:</p>
<ul>
<li>Multiple paths can be mapped to a same method.</li>
<li>Both http/h2 and protobuf services are supported.</li>
<li>Un-mapped methods are still accessible via <code>/ServiceName/MethodName</code>. Mapped methods are <strong>not</strong> accessible via <code>/ServiceName/MethodName</code> anymore.</li>
<li><code>==&gt;</code> and <code> ===&gt;</code> are both OK, namely extra spaces at the beginning or the end, extra slashes, extra commas at the end, are all accepted.</li>
<li>Pattern <code>PATH</code> and <code>PATH/*</code> can coexist.</li>
<li>Support suffix matching: characters can appear after the asterisk.</li>
<li>At most one asterisk is allowed in a path.</li>
</ul>
<p>The path after asterisk can be obtained by <code>cntl.http_request().unresolved_path()</code>, which is always normalized, namely no slashes at the beginning or the end, and no repeated slashes in the middle. For example:</p>
<p><img src="/images/docs/restful_1.png" alt="img"></p>
<p>or:</p>
<p><img src="/images/docs/restful_2.png" alt="img"></p>
<p>in which unresolved_path are both <code>foo/bar</code>. The extra slashes at the left, the right, or the middle are removed.</p>
<p>Note that <code>cntl.http_request().uri().path()</code> is not ensured to be normalized, which is <code>&quot;//v1//queue//stats//foo///bar//////&quot;</code> and <code>&quot;//vars///foo////bar/////&quot;</code> respectively in the above example.</p>
<p>The built-in service page of <code>/status</code> shows customized URLs after the methods, in form of <code>@URL1 @URL2</code> &hellip;</p>
<p><img src="/images/docs/restful_3.png" alt="img"></p>
<h1 id="http-parameters">HTTP Parameters</h1>
<h2 id="http-headers">HTTP headers</h2>
<p>HTTP headers are a series of key/value pairs, some of them are defined by the HTTP specification, while others are free to use.</p>
<p>Query strings are also key/value pairs. Differences between HTTP headers and query strings:</p>
<ul>
<li>Although operations on HTTP headers are accurately defined by the http specification, but http headers cannot be modified directly from an address bar, they are often used for passing parameters of a protocol or framework.</li>
<li>Query strings is part of the URL and <strong>often</strong> in form of <code>key1=value1&amp;key2=value2&amp;...</code>, which is easy to read and modify. They&rsquo;re often used for passing application-level parameters. However format of query strings is not defined in HTTP spec, just a convention.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#8f5902;font-style:italic">// Get value for header &#34;User-Agent&#34; (case insensitive)
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">string</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">user_agent_str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">GetHeader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;User-Agent&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">user_agent_str</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87">NULL</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>  <span style="color:#8f5902;font-style:italic">// has the header
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">LOG</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">TRACE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;User-Agent is &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">user_agent_str</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">...</span>
 
<span style="color:#8f5902;font-style:italic">// Add a header &#34;Accept-encoding: gzip&#34; (case insensitive)
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">SetHeader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Accept-encoding&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;gzip&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#8f5902;font-style:italic">// Overwrite the previous header &#34;Accept-encoding: deflate&#34;
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">SetHeader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Accept-encoding&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;deflate&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#8f5902;font-style:italic">// Append value to the previous header so that it becomes
</span><span style="color:#8f5902;font-style:italic">// &#34;Accept-encoding: deflate,gzip&#34; (values separated by comma)
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">AppendHeader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Accept-encoding&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;gzip&#34;</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><h2 id="content-type">Content-Type</h2>
<p><code>Content-type</code> is a frequently used header for storing type of the HTTP body, and specially processed in brpc and accessible by <code>cntl-&gt;http_request().content_type()</code> . As a correspondence, <code>cntl-&gt;GetHeader(&quot;Content-Type&quot;)</code> returns nothing.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#8f5902;font-style:italic">// Get Content-Type
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">content_type</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;application/json&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000;font-weight:bold">...</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">...</span>
<span style="color:#8f5902;font-style:italic">// Set Content-Type
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">set_content_type</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;text/html&#34;</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><p>If the RPC fails (<code>Controller</code> has been <code>SetFailed</code>), the framework overwrites <code>Content-Type</code> with <code>text/plain</code> and sets the response body with <code>Controller::ErrorText()</code>.</p>
<h2 id="status-code">Status Code</h2>
<p>Status code is a special field in HTTP response to store processing result of the http request. Possible values are defined in <a href="https://github.com/brpc/brpc/blob/master/src/brpc/http_status_code.h">http_status_code.h</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#8f5902;font-style:italic">// Get Status Code
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">status_code</span><span style="color:#000;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">HTTP_STATUS_NOT_FOUND</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">LOG</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">FATAL</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;FAILED: &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#000">controller</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">reason_phrase</span><span style="color:#000;font-weight:bold">();</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#000;font-weight:bold">...</span>
<span style="color:#8f5902;font-style:italic">// Set Status code
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">set_status_code</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">HTTP_STATUS_INTERNAL_SERVER_ERROR</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">set_status_code</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">HTTP_STATUS_INTERNAL_SERVER_ERROR</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;My explanation of the error...&#34;</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><p>For example, following code implements redirection with status code 302:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">set_status_code</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">HTTP_STATUS_FOUND</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_response</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">SetHeader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Location&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;http://bj.bs.bae.baidu.com/family/image001(4979).jpg&#34;</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><p><img src="/images/docs/302.png" alt="img"></p>
<h2 id="query-string">Query String</h2>
<p>As mentioned in above <a href="#http-headers">HTTP headers</a>, query strings are interpreted in common convention, whose form is <code>key1=value1&amp;key2=value2&amp;…</code>. Keys without values are acceptable as well and accessible by <code>GetQuery</code> which returns an empty string. Such keys are often used as boolean flags. Full API are defined in <a href="https://github.com/brpc/brpc/blob/master/src/brpc/uri.h">uri.h</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">string</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">time_value</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">uri</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">GetQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;time&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">time_value</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87">NULL</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>  <span style="color:#8f5902;font-style:italic">// the query string is present
</span><span style="color:#8f5902;font-style:italic"></span>    <span style="color:#000">LOG</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">TRACE</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;time = &#34;</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">time_value</span><span style="color:#000;font-weight:bold">;</span>
<span style="color:#000;font-weight:bold">}</span>

<span style="color:#000;font-weight:bold">...</span>
<span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">uri</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">SetQuery</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;time&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;2015/1/2&#34;</span><span style="color:#000;font-weight:bold">);</span>
</code></pre></div><h1 id="debugging">Debugging</h1>
<p>Turn on <a href="http://brpc.baidu.com:8765/flags/http_verbose">-http_verbose</a> to print contents of all http requests and responses. Note that this should only be used for debugging rather than online services.</p>
<h1 id="compress-the-response-body">Compress the response body</h1>
<p>HTTP services often compress http bodies to reduce transmission latency of web pages and speed up the presentations to end users.</p>
<p>Call <code>Controller::set_response_compress_type(brpc::COMPRESS_TYPE_GZIP)</code> to <strong>try to</strong> compress the http body with gzip. &ldquo;Try to&rdquo; means the compression may not happen in following conditions:</p>
<ul>
<li>
<p>The request does not set <code>Accept-encoding</code> or the value does not contain &ldquo;gzip&rdquo;. For example, curl does not support compression without option <code>--compressed</code>, in which case the server always returns uncompressed results.</p>
</li>
<li>
<p>Body size is less than the bytes specified by -http_body_compress_threshold (512 by default). gzip is not a very fast compression algorithm. When the body is small, the delay added by compression may be larger than the time saved by network transmission. No compression when the body is relatively small is probably a better choice.</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Description</th>
<th>Defined At</th>
</tr>
</thead>
<tbody>
<tr>
<td>http_body_compress_threshold</td>
<td>512</td>
<td>Not compress http body when it&rsquo;s less than so many bytes.</td>
<td>src/brpc/policy/http_rpc_protocol.cpp</td>
</tr>
</tbody>
</table>
</li>
</ul>
<h1 id="decompress-the-request-body">Decompress the request body</h1>
<p>Due to generality, brpc does not decompress request bodies automatically, but users can do the job by themselves as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;brpc/policy/gzip_compress.h&gt;</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">...</span>
<span style="color:#204a87;font-weight:bold">const</span> <span style="color:#000">std</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">string</span><span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">encoding</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">http_request</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">GetHeader</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Content-Encoding&#34;</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#000">encoding</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87">NULL</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">encoding</span> <span style="color:#ce5c00;font-weight:bold">==</span> <span style="color:#4e9a06">&#34;gzip&#34;</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#000;font-weight:bold">{</span>
    <span style="color:#000">butil</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">IOBuf</span> <span style="color:#000">uncompressed</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">!</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">policy</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">GzipDecompress</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">request_attachment</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">uncompressed</span><span style="color:#000;font-weight:bold">))</span> <span style="color:#000;font-weight:bold">{</span>
        <span style="color:#000">LOG</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">ERROR</span><span style="color:#000;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">&lt;&lt;</span> <span style="color:#4e9a06">&#34;Fail to un-gzip request body&#34;</span><span style="color:#000;font-weight:bold">;</span>
        <span style="color:#204a87;font-weight:bold">return</span><span style="color:#000;font-weight:bold">;</span>
    <span style="color:#000;font-weight:bold">}</span>
    <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">request_attachment</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">swap</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">uncompressed</span><span style="color:#000;font-weight:bold">);</span>
<span style="color:#000;font-weight:bold">}</span>
<span style="color:#8f5902;font-style:italic">// cntl-&gt;request_attachment() contains the data after decompression
</span></code></pre></div><h1 id="serve-https-requests">Serve https requests</h1>
<p>https is short for &ldquo;http over SSL&rdquo;, SSL is not exclusive for http, but effective for all protocols. The generic method for turning on server-side SSL is <a href="../basics/#turn-on-ssl">here</a>.</p>
<h1 id="performance">Performance</h1>
<p>Productions without extreme performance requirements tend to use HTTP protocol, especially mobile products. Thus we put great emphasis on implementation qualities of HTTP. To be more specific:</p>
<ul>
<li>Use <a href="https://github.com/brpc/brpc/blob/master/src/brpc/details/http_parser.h">http parser</a> of node.js to parse http messages, which is a lightweight, well-written, and extensively used implementation.</li>
<li>Use <a href="https://github.com/miloyip/rapidjson">rapidjson</a> to parse json, which is a json library focuses on performance.</li>
<li>In the worst case, the time complexity of parsing http requests is still O(N), where N is byte size of the request. As a contrast, parsing code that requires the http request to be complete, may cost O(N^2) time in the worst case. This feature is very helpful since many HTTP requests are large.</li>
<li>Processing HTTP messages from different clients is highly concurrent, even a pretty complicated http message does not block responding other clients. It&rsquo;s difficult to achieve this for other RPC implementations and http servers often based on <a href="../../rpc-in-depth/threading-overview/#single-threaded-reactorhttpenwikipediaorgwikireactor_pattern">single-threaded reactor</a>.</li>
</ul>
<h1 id="progressive-sending">Progressive sending</h1>
<p>brpc server is capable of sending large or infinite sized body, in following steps:</p>
<ol>
<li>Call <code>Controller::CreateProgressiveAttachment()</code> to create a body that can be written progressively. The returned <code>ProgressiveAttachment</code> object should be managed by <code>intrusive_ptr</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#8f5902;font-style:italic">#include</span> <span style="color:#8f5902;font-style:italic">&lt;brpc/progressive_attachment.h&gt;</span><span style="color:#8f5902;font-style:italic">
</span><span style="color:#8f5902;font-style:italic"></span><span style="color:#000;font-weight:bold">...</span>
<span style="color:#000">butil</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">intrusive_ptr</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">brpc</span><span style="color:#ce5c00;font-weight:bold">::</span><span style="color:#000">ProgressiveAttachment</span><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">pa</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cntl</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span><span style="color:#000">CreateProgressiveAttachment</span><span style="color:#000;font-weight:bold">();</span>
</code></pre></div><ol start="2">
<li>
<p>Call <code>ProgressiveAttachment::Write()</code> to send the data.</p>
<ul>
<li>If the write occurs before running of the server-side done, the sent data is cached until the done is called.</li>
<li>If the write occurs after running of the server-side done, the sent data is written out in chunked mode immediately.</li>
</ul>
</li>
<li>
<p>After usage, destruct all <code>butil::intrusive_ptr&lt;brpc::ProgressiveAttachment&gt;</code> to release related resources.</p>
</li>
</ol>
<h1 id="progressive-receiving">Progressive receiving</h1>
<p>Currently brpc server doesn&rsquo;t support calling the service callback once header part in the http request is parsed. In other words, brpc server is not suitable for receiving large or infinite sized body.</p>
<h1 id="faq">FAQ</h1>
<h3 id="q-the-nginx-before-brpc-encounters-final-fail">Q: The nginx before brpc encounters final fail</h3>
<p>The error is caused by that brpc server closes the http connection directly without sending a response.</p>
<p>brpc server supports a variety of protocols on the same port. When a request is failed to be parsed in HTTP, it&rsquo;s hard to tell that the request is definitely in HTTP. If the request is very likely to be one, the server sends HTTP 400 errors and closes the connection. However, if the error is caused HTTP method(at the beginning) or ill-formed serialization (may be caused by bugs at the HTTP client), the server still closes the connection without sending a response, which leads to &ldquo;final fail&rdquo; at nginx.</p>
<p>Solution: When using Nginx to forward traffic, set <code>$HTTP_method</code> to allowed HTTP methods or simply specify the HTTP method in <code>proxy_method</code>.</p>
<h3 id="q-does-brpc-support-http-chunked-mode">Q: Does brpc support http chunked mode</h3>
<p>Yes.</p>
<h3 id="q-why-do-http-requests-containing-base64-encoded-query-string-fail-to-parse-sometimes">Q: Why do HTTP requests containing BASE64 encoded query string fail to parse sometimes?</h3>
<p>According to the <a href="http://tools.ietf.org/html/rfc3986#section-2.2">HTTP specification</a>, following characters need to be encoded with <code>%</code>.</p>
<pre><code>       reserved    = gen-delims / sub-delims

       gen-delims  = &quot;:&quot; / &quot;/&quot; / &quot;?&quot; / &quot;#&quot; / &quot;[&quot; / &quot;]&quot; / &quot;@&quot;

       sub-delims  = &quot;!&quot; / &quot;$&quot; / &quot;&amp;&quot; / &quot;'&quot; / &quot;(&quot; / &quot;)&quot;
                   / &quot;*&quot; / &quot;+&quot; / &quot;,&quot; / &quot;;&quot; / &quot;=&quot;
</code></pre><p>Base64 encoded string may end with <code>=</code> which is a reserved character (take <code>?wi=NDgwMDB8dGVzdA==&amp;anothorkey=anothervalue</code> as an example). The strings may be parsed successfully, or may be not, depending on the implementation which should not be assumed in principle.</p>
<p>One solution is to remove the trailing <code>=</code> which does not affect the <a href="http://en.wikipedia.org/wiki/Base64#Padding">Base64 decoding</a>. Another method is to <a href="https://en.wikipedia.org/wiki/Percent-encoding">percent-encode</a> the URI, and do percent-decoding before Base64 decoding.</p>

        <div class="section-index">
    
    
    
    
    <hr class="panel-line">
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
            
        
    
</div>

	
	
	<div class="text-muted mt-5 pt-3 border-top">Last modified May 17, 2022: <a  href="https://github.com/apache/incubator-brpc-website/commit/a31ce10d3d732f29e56dd2c8c8a0d07c3e633209">update brpc users page (#71) (a31ce10)</a>
</div>
</div>

          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none" style="display: flex; align-items: center; padding: 0 !important;">
  <div class="container-fluid mx-sm-5">
    <div class="row" style="display: flex; align-items: center;">
      <div class="col-12 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/apache/incubator-brpc">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation. All Rights Reserved</small>
        
	
        <div style="font-size: 12.8px; color: rgb(117, 116, 116);">
          <a href="https://www.apache.org/foundation/how-it-works.html" target="_blank" rel="noopener">Foundation</a> |
          <a href="https://www.apache.org/licenses/" target="_blank" rel="noopener">License</a> |
          <a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener">Sponsorship</a> |
          <a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener">Thanks</a>
        </div>
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>






<script src="/js/main.min.170adf90fd476d5f9243ed2e727149abe8d9fe364587fe943765d47375bbd1ad.js" integrity="sha256-FwrfkP1HbV&#43;SQ&#43;0ucnFJq&#43;jZ/jZFh/6UN2XUc3W70a0=" crossorigin="anonymous"></script>





  </body>
</html>