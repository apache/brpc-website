<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.105.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>brpc初学者指南 | bRPC</title><meta property="og:title" content="brpc初学者指南"><meta property="og:description" content="(作者简介：lorinlee，是brpc新进committer，在字节跳动负责图数据库相关工作）
Apache brpc(incubating) 是一款优秀的工业级 C++ RPC 框架，其兼具高性能、兼容多种协议、周边工具完善等多种优点于一身，已在国内多个大厂广泛使用。
有不少同学对brpc感兴趣，但还没有找到合适的路径，不知道如何学习。笔者是来自字节跳动的研发工程师，也曾遇到相同的困扰，后来通过自己的一些摸索，成为了brpc committer，期间也总结了一些经验，希望对大家有所帮助。
因此本文期望结合作者的经历，通过一些简单可行的步骤，帮助大家迈出探索brpc的脚步，学习它的设计与实现方式，以对大家日常的学习和工作有所帮助。也欢迎大家在熟悉brpc之后，参与到brpc的贡献中，比如文档完善、解决issue、bugfix、feature开发等等。
文档 初始接触brpc，文档是最好的入手材料。brpc的文档在国内开源项目中广受赞誉，原因是其不仅介绍了丰富的技术知识，还蕴含了设计者深入的思考与选择。
首先推荐阅读：bRPC Overview，这篇文档不仅综述性地介绍了brpc，它更是一篇索引，关键的技术都有超链接至对应的细节文档，阅读完这篇文档以及所有的链接，将能够对brpc有完整的认识。
另外，有些文档虽然在上面链接中已经涵盖了，但我依然想在这里再单独分类推荐一下：
IO：RPC框架作为网络通信框架，IO模型是非常重要的一环，其定义了客户端如何发送消息，服务端如何接受消息，这篇文档详细介绍了brpc对于这一过程的实现。常见的RPC框架会区分IO线程和Worker线程，但这样的设计是有弊端的。brpc则不对线程做区分，IO逻辑和业务逻辑全都在bthread中，通过调度器平衡任务在线程之间的负载。另外，brpc支持多种协议，并支持灵活的拓展，可以参考 protocol。
线程模型，bthread：RPC框架另一个重要的部分是线程模型，brpc自研了用户态调度的M:N线程库bthread，既能达到优异的性能，又不会损失代码的可维护性。
bthread_id：这里的bthread_id并不是bthread本身的id（bthread_t），而是用于对同一个request的多次重试、超时处理等并发事件进行同步，以及在连接复用（单连接）的场景，维护request和response的映射。
IOBuf：RPC框架需要处理大量接收的消息、发送的消息，其中消息占用的内存分配在很多场景都可能会成为一大开销，brpc通过IOBuf减少内存分配、拷贝等开销。
Timer：RPC场景需要处理大量的时间事件，主要是对于超时的控制，比如对于一个请求，需要在其超时后及时终止并结束。一般的系统在吞吐上升的过程中，Timer的压力会不断增加，其拓展性会成为性能瓶颈。而brpc对Timer做了细致的设计，使timer操作几乎对RPC性能没有影响。
MemoryManagement：brpc实现了内存池对一些对象进行管理以提升性能，并且可以对这些对象附加version，简化了共享对象的回收逻辑。
bvar：系统服务通常需要采集大量的指标，用于系统监控、性能优化等，但通常大量的指标采集会严重影响性能，有些做法是通过采样来降低开销，但会导致指标不够准确。brpc的bvar则能够高效的收集大量指标。
源码 文档能够快速了解系统的核心设计思路，但如果要深入理解系统，还是需要对源码进行阅读。brpc是一款优秀的C++项目，其源码是值得大家阅读学习的。这里简单为大家把源码进行一些介绍，方便大家阅读。
整体的源码阅读过程，推荐先按照某些关键的执行流程来阅读，梳理其中的各个环节步骤，就能够理解每个模块在整个系统所处的位置；随后单独对重要的模块研读其实现，就能够比较好地掌握整个系统。
RPC框架一般会用在两个端，客户端和服务端，两者有些流程是共用的，有些是不同的。所以可以将简单的echo服务为出发点，分别对客户端和服务端的流程进行阅读。
客户端 对于客户端，典型的流程比如：客户端的初始化，发起RPC请求，处理应答，以及处理超时等逻辑。这里对一些关键的过程进行简述，大家可以在阅读过程中搜寻下述的一些关键函数名，找到代码对应的位置：
客户端的初始化：Channel::Init，这里会做全局的初始化（GlobalInitializeOrDie），NamingService线程、LoadBalancer的初始化等。
发起RPC请求：Channel::CallMethod，这里会分配call_id（bthread_id），序列化请求内容（_serialize_request -> Protocol::SerializeRequest），注册BackupRequest/Timeout的事件，选择要发送消息的Socket，打包协议内容（_pack_request -> Protocol::PackRequest），消息写入fd（Socket::Write）。
处理应答：客户端在创建Socket时，会将对应的fd放在EventDispatcher中，并注册对应的回调函数（InputMessenger::OnNewMessages）。在Linux系统下，当fd有可读数据，EventDispatcher::Run中会通过epoll_wait拿到对应fd，调用Socket::StartInputEvent，并最终回调至InputMessenger::OnNewMessages。在InputMessenger::OnNewMessages中，会从fd中读取数据，按请求粒度切分数据，并将每个请求通过协议定义的处理函数中进行执行（Protocol::ProcessResponse），并最终调用至Controller::OnVersionedRPCReturned结束RPC，或执行重试等。
处理超时：超时事件是注册在Timer线程中的，在RPC超时后，Timer线程会回调HandleTimeout，并经由bthread_id的机制回调至Controller::HandleSocketFailed，最终也会到达Controller::OnVersionedRPCReturned，在这里结束RPC或执行重试等。
服务端 对于服务端，典型的流程包括：服务的启动，收到RPC请求，执行处理，返回应答等逻辑。这里也对一些关键的过程进行简述，方便大家找到对应的代码位置：
服务启动：Server::Start，这里会做一些初始化（Server::InitializeOnce），数据存储工厂初始化（SessionData，ThreadLocalData，bthread_local），创建Acceptor用于接受客户端连接。
收到RPC请求：服务端收到的请求也是通过EventDispatcher进行派发的。在收到客户端连接请求时，EventDispatcher会回调Acceptor::OnNewConnections进行新连接建立，并将新连接也托管至EventDispatcher。在连接收到数据后，会由EventDispatcher回调至InputMessenger::OnNewMessages，从fd中读取数据，对数据按请求粒度进行切分，并调用协议中注册的处理函数（Protocol::ProcessRequest）进行处理。（客户端和服务端在这里注册的回调是不同的）。
执行处理：请求的处理逻辑与协议有关，不过大体的逻辑是相似的，这里以baidu_std协议为例简述一下处理流程。baidu_std协议的请求处理逻辑在ProcessRpcRequest中，其会设置一些上下文信息，并发控制与限流，反序列化协议头和元数据，根据元数据找到具体的请求信息，反序列化请求体，注册RPC结束（done->Run()）的回调函数（SendRpcResponse），并调用用户注册的Service对应方法进行处理。
返回应答：在用户处理函数处理结束后，通常会调用done->Run()结束RPC，此时会回调上面注册的函数SendRpcResponse，将用户写好的Response，连同协议头和元数据一起序列化，写入fd中。
源码目录 这里再对brpc的源码目录做个基本的介绍，方便大家有个整体认识。首先推荐大家阅读brpc中的示例，其能够帮助大家对brpc的使用场景和使用方法有所了解，并在后续对核心系统源码阅读的过程能够带着使用场景阅读。
example目录下，主要有几个目录：
echo_c++：同步客户端的echo示例
asynchronous_echo_c++：异步客户端的echo示例
backup_request_c++：客户端开启backup_request示例
cancel_c++：客户端取消rpc示例
parallel_echo_c++：客户端同时访问多个服务示例
partition_echo_c++：客户端分区调用的示例
dynamic_partition_echo_c++：客户端动态分区调用的示例
selective_echo_c++：客户端多Channel间负载均衡示例
multi_threaded_echo_c++：客户端多线程echo示例
multi_threaded_echo_fns_c++：客户端多线程+服务端多server示例
auto_concurrency_limiter：服务端开启自适应限流并验证其有效性
cascade_echo_c++：服务端级联调用示例
session_data_and_thread_local：服务端使用SessionData和ThreadLocalData
grpc_c++：grpc协议示例
http_c++：http协议示例
memcache_c++：memcache客户端示例
redis_c++：redis协议示例
thrift_extension_c++：thrift协议示例
streaming_echo_c++：大块数据传输示例
而brpc系统核心的实现在src目录中，其主要有几个目录：
brpc
brpc目录下主要是RPC框架的实现，内容相对比较多，涵盖了网络通信框架、支持的各种协议、builtin服务等，以及包括负载均衡、服务发现、限流等。
bthread
bthread目录下主要是用户态调度的M:N线程库的实现。其中包括bthread调度器、bthread同步原语、timer线程等。"><meta property="og:type" content="article"><meta property="og:url" content="https://brpc.incubator.apache.org/zh/docs/blogs/shares/brpc-guide-for-beginners/"><meta property="article:section" content="docs"><meta property="article:published_time" content="2021-11-30T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-31T17:05:27+08:00"><meta property="og:site_name" content="bRPC"><meta itemprop=name content="brpc初学者指南"><meta itemprop=description content="(作者简介：lorinlee，是brpc新进committer，在字节跳动负责图数据库相关工作）
Apache brpc(incubating) 是一款优秀的工业级 C++ RPC 框架，其兼具高性能、兼容多种协议、周边工具完善等多种优点于一身，已在国内多个大厂广泛使用。
有不少同学对brpc感兴趣，但还没有找到合适的路径，不知道如何学习。笔者是来自字节跳动的研发工程师，也曾遇到相同的困扰，后来通过自己的一些摸索，成为了brpc committer，期间也总结了一些经验，希望对大家有所帮助。
因此本文期望结合作者的经历，通过一些简单可行的步骤，帮助大家迈出探索brpc的脚步，学习它的设计与实现方式，以对大家日常的学习和工作有所帮助。也欢迎大家在熟悉brpc之后，参与到brpc的贡献中，比如文档完善、解决issue、bugfix、feature开发等等。
文档 初始接触brpc，文档是最好的入手材料。brpc的文档在国内开源项目中广受赞誉，原因是其不仅介绍了丰富的技术知识，还蕴含了设计者深入的思考与选择。
首先推荐阅读：bRPC Overview，这篇文档不仅综述性地介绍了brpc，它更是一篇索引，关键的技术都有超链接至对应的细节文档，阅读完这篇文档以及所有的链接，将能够对brpc有完整的认识。
另外，有些文档虽然在上面链接中已经涵盖了，但我依然想在这里再单独分类推荐一下：
IO：RPC框架作为网络通信框架，IO模型是非常重要的一环，其定义了客户端如何发送消息，服务端如何接受消息，这篇文档详细介绍了brpc对于这一过程的实现。常见的RPC框架会区分IO线程和Worker线程，但这样的设计是有弊端的。brpc则不对线程做区分，IO逻辑和业务逻辑全都在bthread中，通过调度器平衡任务在线程之间的负载。另外，brpc支持多种协议，并支持灵活的拓展，可以参考 protocol。
线程模型，bthread：RPC框架另一个重要的部分是线程模型，brpc自研了用户态调度的M:N线程库bthread，既能达到优异的性能，又不会损失代码的可维护性。
bthread_id：这里的bthread_id并不是bthread本身的id（bthread_t），而是用于对同一个request的多次重试、超时处理等并发事件进行同步，以及在连接复用（单连接）的场景，维护request和response的映射。
IOBuf：RPC框架需要处理大量接收的消息、发送的消息，其中消息占用的内存分配在很多场景都可能会成为一大开销，brpc通过IOBuf减少内存分配、拷贝等开销。
Timer：RPC场景需要处理大量的时间事件，主要是对于超时的控制，比如对于一个请求，需要在其超时后及时终止并结束。一般的系统在吞吐上升的过程中，Timer的压力会不断增加，其拓展性会成为性能瓶颈。而brpc对Timer做了细致的设计，使timer操作几乎对RPC性能没有影响。
MemoryManagement：brpc实现了内存池对一些对象进行管理以提升性能，并且可以对这些对象附加version，简化了共享对象的回收逻辑。
bvar：系统服务通常需要采集大量的指标，用于系统监控、性能优化等，但通常大量的指标采集会严重影响性能，有些做法是通过采样来降低开销，但会导致指标不够准确。brpc的bvar则能够高效的收集大量指标。
源码 文档能够快速了解系统的核心设计思路，但如果要深入理解系统，还是需要对源码进行阅读。brpc是一款优秀的C++项目，其源码是值得大家阅读学习的。这里简单为大家把源码进行一些介绍，方便大家阅读。
整体的源码阅读过程，推荐先按照某些关键的执行流程来阅读，梳理其中的各个环节步骤，就能够理解每个模块在整个系统所处的位置；随后单独对重要的模块研读其实现，就能够比较好地掌握整个系统。
RPC框架一般会用在两个端，客户端和服务端，两者有些流程是共用的，有些是不同的。所以可以将简单的echo服务为出发点，分别对客户端和服务端的流程进行阅读。
客户端 对于客户端，典型的流程比如：客户端的初始化，发起RPC请求，处理应答，以及处理超时等逻辑。这里对一些关键的过程进行简述，大家可以在阅读过程中搜寻下述的一些关键函数名，找到代码对应的位置：
客户端的初始化：Channel::Init，这里会做全局的初始化（GlobalInitializeOrDie），NamingService线程、LoadBalancer的初始化等。
发起RPC请求：Channel::CallMethod，这里会分配call_id（bthread_id），序列化请求内容（_serialize_request -> Protocol::SerializeRequest），注册BackupRequest/Timeout的事件，选择要发送消息的Socket，打包协议内容（_pack_request -> Protocol::PackRequest），消息写入fd（Socket::Write）。
处理应答：客户端在创建Socket时，会将对应的fd放在EventDispatcher中，并注册对应的回调函数（InputMessenger::OnNewMessages）。在Linux系统下，当fd有可读数据，EventDispatcher::Run中会通过epoll_wait拿到对应fd，调用Socket::StartInputEvent，并最终回调至InputMessenger::OnNewMessages。在InputMessenger::OnNewMessages中，会从fd中读取数据，按请求粒度切分数据，并将每个请求通过协议定义的处理函数中进行执行（Protocol::ProcessResponse），并最终调用至Controller::OnVersionedRPCReturned结束RPC，或执行重试等。
处理超时：超时事件是注册在Timer线程中的，在RPC超时后，Timer线程会回调HandleTimeout，并经由bthread_id的机制回调至Controller::HandleSocketFailed，最终也会到达Controller::OnVersionedRPCReturned，在这里结束RPC或执行重试等。
服务端 对于服务端，典型的流程包括：服务的启动，收到RPC请求，执行处理，返回应答等逻辑。这里也对一些关键的过程进行简述，方便大家找到对应的代码位置：
服务启动：Server::Start，这里会做一些初始化（Server::InitializeOnce），数据存储工厂初始化（SessionData，ThreadLocalData，bthread_local），创建Acceptor用于接受客户端连接。
收到RPC请求：服务端收到的请求也是通过EventDispatcher进行派发的。在收到客户端连接请求时，EventDispatcher会回调Acceptor::OnNewConnections进行新连接建立，并将新连接也托管至EventDispatcher。在连接收到数据后，会由EventDispatcher回调至InputMessenger::OnNewMessages，从fd中读取数据，对数据按请求粒度进行切分，并调用协议中注册的处理函数（Protocol::ProcessRequest）进行处理。（客户端和服务端在这里注册的回调是不同的）。
执行处理：请求的处理逻辑与协议有关，不过大体的逻辑是相似的，这里以baidu_std协议为例简述一下处理流程。baidu_std协议的请求处理逻辑在ProcessRpcRequest中，其会设置一些上下文信息，并发控制与限流，反序列化协议头和元数据，根据元数据找到具体的请求信息，反序列化请求体，注册RPC结束（done->Run()）的回调函数（SendRpcResponse），并调用用户注册的Service对应方法进行处理。
返回应答：在用户处理函数处理结束后，通常会调用done->Run()结束RPC，此时会回调上面注册的函数SendRpcResponse，将用户写好的Response，连同协议头和元数据一起序列化，写入fd中。
源码目录 这里再对brpc的源码目录做个基本的介绍，方便大家有个整体认识。首先推荐大家阅读brpc中的示例，其能够帮助大家对brpc的使用场景和使用方法有所了解，并在后续对核心系统源码阅读的过程能够带着使用场景阅读。
example目录下，主要有几个目录：
echo_c++：同步客户端的echo示例
asynchronous_echo_c++：异步客户端的echo示例
backup_request_c++：客户端开启backup_request示例
cancel_c++：客户端取消rpc示例
parallel_echo_c++：客户端同时访问多个服务示例
partition_echo_c++：客户端分区调用的示例
dynamic_partition_echo_c++：客户端动态分区调用的示例
selective_echo_c++：客户端多Channel间负载均衡示例
multi_threaded_echo_c++：客户端多线程echo示例
multi_threaded_echo_fns_c++：客户端多线程+服务端多server示例
auto_concurrency_limiter：服务端开启自适应限流并验证其有效性
cascade_echo_c++：服务端级联调用示例
session_data_and_thread_local：服务端使用SessionData和ThreadLocalData
grpc_c++：grpc协议示例
http_c++：http协议示例
memcache_c++：memcache客户端示例
redis_c++：redis协议示例
thrift_extension_c++：thrift协议示例
streaming_echo_c++：大块数据传输示例
而brpc系统核心的实现在src目录中，其主要有几个目录：
brpc
brpc目录下主要是RPC框架的实现，内容相对比较多，涵盖了网络通信框架、支持的各种协议、builtin服务等，以及包括负载均衡、服务发现、限流等。
bthread
bthread目录下主要是用户态调度的M:N线程库的实现。其中包括bthread调度器、bthread同步原语、timer线程等。"><meta itemprop=datePublished content="2021-11-30T00:00:00+00:00"><meta itemprop=dateModified content="2022-10-31T17:05:27+08:00"><meta itemprop=wordCount content="118"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="brpc初学者指南"><meta name=twitter:description content="(作者简介：lorinlee，是brpc新进committer，在字节跳动负责图数据库相关工作）
Apache brpc(incubating) 是一款优秀的工业级 C++ RPC 框架，其兼具高性能、兼容多种协议、周边工具完善等多种优点于一身，已在国内多个大厂广泛使用。
有不少同学对brpc感兴趣，但还没有找到合适的路径，不知道如何学习。笔者是来自字节跳动的研发工程师，也曾遇到相同的困扰，后来通过自己的一些摸索，成为了brpc committer，期间也总结了一些经验，希望对大家有所帮助。
因此本文期望结合作者的经历，通过一些简单可行的步骤，帮助大家迈出探索brpc的脚步，学习它的设计与实现方式，以对大家日常的学习和工作有所帮助。也欢迎大家在熟悉brpc之后，参与到brpc的贡献中，比如文档完善、解决issue、bugfix、feature开发等等。
文档 初始接触brpc，文档是最好的入手材料。brpc的文档在国内开源项目中广受赞誉，原因是其不仅介绍了丰富的技术知识，还蕴含了设计者深入的思考与选择。
首先推荐阅读：bRPC Overview，这篇文档不仅综述性地介绍了brpc，它更是一篇索引，关键的技术都有超链接至对应的细节文档，阅读完这篇文档以及所有的链接，将能够对brpc有完整的认识。
另外，有些文档虽然在上面链接中已经涵盖了，但我依然想在这里再单独分类推荐一下：
IO：RPC框架作为网络通信框架，IO模型是非常重要的一环，其定义了客户端如何发送消息，服务端如何接受消息，这篇文档详细介绍了brpc对于这一过程的实现。常见的RPC框架会区分IO线程和Worker线程，但这样的设计是有弊端的。brpc则不对线程做区分，IO逻辑和业务逻辑全都在bthread中，通过调度器平衡任务在线程之间的负载。另外，brpc支持多种协议，并支持灵活的拓展，可以参考 protocol。
线程模型，bthread：RPC框架另一个重要的部分是线程模型，brpc自研了用户态调度的M:N线程库bthread，既能达到优异的性能，又不会损失代码的可维护性。
bthread_id：这里的bthread_id并不是bthread本身的id（bthread_t），而是用于对同一个request的多次重试、超时处理等并发事件进行同步，以及在连接复用（单连接）的场景，维护request和response的映射。
IOBuf：RPC框架需要处理大量接收的消息、发送的消息，其中消息占用的内存分配在很多场景都可能会成为一大开销，brpc通过IOBuf减少内存分配、拷贝等开销。
Timer：RPC场景需要处理大量的时间事件，主要是对于超时的控制，比如对于一个请求，需要在其超时后及时终止并结束。一般的系统在吞吐上升的过程中，Timer的压力会不断增加，其拓展性会成为性能瓶颈。而brpc对Timer做了细致的设计，使timer操作几乎对RPC性能没有影响。
MemoryManagement：brpc实现了内存池对一些对象进行管理以提升性能，并且可以对这些对象附加version，简化了共享对象的回收逻辑。
bvar：系统服务通常需要采集大量的指标，用于系统监控、性能优化等，但通常大量的指标采集会严重影响性能，有些做法是通过采样来降低开销，但会导致指标不够准确。brpc的bvar则能够高效的收集大量指标。
源码 文档能够快速了解系统的核心设计思路，但如果要深入理解系统，还是需要对源码进行阅读。brpc是一款优秀的C++项目，其源码是值得大家阅读学习的。这里简单为大家把源码进行一些介绍，方便大家阅读。
整体的源码阅读过程，推荐先按照某些关键的执行流程来阅读，梳理其中的各个环节步骤，就能够理解每个模块在整个系统所处的位置；随后单独对重要的模块研读其实现，就能够比较好地掌握整个系统。
RPC框架一般会用在两个端，客户端和服务端，两者有些流程是共用的，有些是不同的。所以可以将简单的echo服务为出发点，分别对客户端和服务端的流程进行阅读。
客户端 对于客户端，典型的流程比如：客户端的初始化，发起RPC请求，处理应答，以及处理超时等逻辑。这里对一些关键的过程进行简述，大家可以在阅读过程中搜寻下述的一些关键函数名，找到代码对应的位置：
客户端的初始化：Channel::Init，这里会做全局的初始化（GlobalInitializeOrDie），NamingService线程、LoadBalancer的初始化等。
发起RPC请求：Channel::CallMethod，这里会分配call_id（bthread_id），序列化请求内容（_serialize_request -> Protocol::SerializeRequest），注册BackupRequest/Timeout的事件，选择要发送消息的Socket，打包协议内容（_pack_request -> Protocol::PackRequest），消息写入fd（Socket::Write）。
处理应答：客户端在创建Socket时，会将对应的fd放在EventDispatcher中，并注册对应的回调函数（InputMessenger::OnNewMessages）。在Linux系统下，当fd有可读数据，EventDispatcher::Run中会通过epoll_wait拿到对应fd，调用Socket::StartInputEvent，并最终回调至InputMessenger::OnNewMessages。在InputMessenger::OnNewMessages中，会从fd中读取数据，按请求粒度切分数据，并将每个请求通过协议定义的处理函数中进行执行（Protocol::ProcessResponse），并最终调用至Controller::OnVersionedRPCReturned结束RPC，或执行重试等。
处理超时：超时事件是注册在Timer线程中的，在RPC超时后，Timer线程会回调HandleTimeout，并经由bthread_id的机制回调至Controller::HandleSocketFailed，最终也会到达Controller::OnVersionedRPCReturned，在这里结束RPC或执行重试等。
服务端 对于服务端，典型的流程包括：服务的启动，收到RPC请求，执行处理，返回应答等逻辑。这里也对一些关键的过程进行简述，方便大家找到对应的代码位置：
服务启动：Server::Start，这里会做一些初始化（Server::InitializeOnce），数据存储工厂初始化（SessionData，ThreadLocalData，bthread_local），创建Acceptor用于接受客户端连接。
收到RPC请求：服务端收到的请求也是通过EventDispatcher进行派发的。在收到客户端连接请求时，EventDispatcher会回调Acceptor::OnNewConnections进行新连接建立，并将新连接也托管至EventDispatcher。在连接收到数据后，会由EventDispatcher回调至InputMessenger::OnNewMessages，从fd中读取数据，对数据按请求粒度进行切分，并调用协议中注册的处理函数（Protocol::ProcessRequest）进行处理。（客户端和服务端在这里注册的回调是不同的）。
执行处理：请求的处理逻辑与协议有关，不过大体的逻辑是相似的，这里以baidu_std协议为例简述一下处理流程。baidu_std协议的请求处理逻辑在ProcessRpcRequest中，其会设置一些上下文信息，并发控制与限流，反序列化协议头和元数据，根据元数据找到具体的请求信息，反序列化请求体，注册RPC结束（done->Run()）的回调函数（SendRpcResponse），并调用用户注册的Service对应方法进行处理。
返回应答：在用户处理函数处理结束后，通常会调用done->Run()结束RPC，此时会回调上面注册的函数SendRpcResponse，将用户写好的Response，连同协议头和元数据一起序列化，写入fd中。
源码目录 这里再对brpc的源码目录做个基本的介绍，方便大家有个整体认识。首先推荐大家阅读brpc中的示例，其能够帮助大家对brpc的使用场景和使用方法有所了解，并在后续对核心系统源码阅读的过程能够带着使用场景阅读。
example目录下，主要有几个目录：
echo_c++：同步客户端的echo示例
asynchronous_echo_c++：异步客户端的echo示例
backup_request_c++：客户端开启backup_request示例
cancel_c++：客户端取消rpc示例
parallel_echo_c++：客户端同时访问多个服务示例
partition_echo_c++：客户端分区调用的示例
dynamic_partition_echo_c++：客户端动态分区调用的示例
selective_echo_c++：客户端多Channel间负载均衡示例
multi_threaded_echo_c++：客户端多线程echo示例
multi_threaded_echo_fns_c++：客户端多线程+服务端多server示例
auto_concurrency_limiter：服务端开启自适应限流并验证其有效性
cascade_echo_c++：服务端级联调用示例
session_data_and_thread_local：服务端使用SessionData和ThreadLocalData
grpc_c++：grpc协议示例
http_c++：http协议示例
memcache_c++：memcache客户端示例
redis_c++：redis协议示例
thrift_extension_c++：thrift协议示例
streaming_echo_c++：大块数据传输示例
而brpc系统核心的实现在src目录中，其主要有几个目录：
brpc
brpc目录下主要是RPC框架的实现，内容相对比较多，涵盖了网络通信框架、支持的各种协议、builtin服务等，以及包括负载均衡、服务发现、限流等。
bthread
bthread目录下主要是用户态调度的M:N线程库的实现。其中包括bthread调度器、bthread同步原语、timer线程等。"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-93485976-3","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=preload href=/scss/main.min.fdeb960b10259a4ba01719d39b27531b8cc22fc9df6dca825590cf18ae192feb.css as=style><link href=/scss/main.min.fdeb960b10259a4ba01719d39b27531b8cc22fc9df6dca825590cf18ae192feb.css rel=stylesheet integrity><script src=/js/jquery-3.3.1.min.js></script><title>brpc初学者指南 | bRPC</title></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/zh/><span class=navbar-logo><svg width="303" height="259" viewBox="0 0 303 259" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>brpc_logo.svg</title><defs><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-1"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-2"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-3"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient><linearGradient x1="50%" y1="0" x2="50%" y2="100%" id="linearGradient-4"><stop stop-color="#b5b5b5" offset="0"/><stop stop-color="#7e7e7e" offset="100%"/></linearGradient></defs><g id="页面-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><circle id="椭圆形" fill="#58b8ff" cx="23.5" cy="62.5" r="23.5"/><circle id="椭圆形" fill="#58b8ff" cx="279.5" cy="60.5" r="23.5"/><circle id="椭圆形" fill="#58b8ff" cx="119" cy="26" r="26"/><rect id="矩形" fill="#58b8ff" transform="translate(78.021813, 41.967662) rotate(-22.000000) translate(-78.021813, -41.967662)" x="30.0218125" y="35.9676616" width="96" height="12"/><rect id="矩形" fill="#58b8ff" transform="translate(201.451088, 44.299021) rotate(13.000000) translate(-201.451088, -44.299021)" x="138.951088" y="38.2990214" width="125" height="12"/><g id="brpc-logo" transform="translate(11.000000, 104.000000)" fill-rule="nonzero"><g id="编组" transform="translate(138.000000, 77.419111) scale(-1, 1) rotate(-180.000000) translate(-138.000000, -77.419111) translate(0.000000, 0.000000)"><path d="M18.8 154.3C17.8 154.1 17 153.8 17 153.6 17 153.5 13.2 134.3 8.5 111 3.8 87.7-205355861e-22 68-205355861e-22 67.4-205355861e-22 65.9 2.6 65.3 5.7 65.8 7.3 66.1 8.1 67.2 8.6 69.6 9.3 73.5 10 73.8 11.7 71.1 15 65.9 28.8 63.2 36.4 66.4 48.9 71.6 57.7 89.6 56.8 108.1c-.5 10-2.5 14.5-7.8 17.1C44.5 127.5 36.6 127.5 31.4 125.1 27 123.1 20.8814242 116.827994 20 115.8 19.8268414 115.598047 19.5 115 19 115.2 18.3 115.4 18.3 116.5 19 118.7 19.6 120.4 21.6 129 23.4 137.8l3.3 16L24.6 154.4C22.3 155 21.4 155 18.8 154.3zm24.6146505-36.885789c1.7578246-1.326292 2.0864078-1.825452 2.4530432-2.642066S46.8138702 112.705545 47.1008328 111.513935C48.333925 109.104457 47.0101697 95.2413285 45.0724535 89.7736686 41.197021 79.2090375 34.9434822 73 28.2495534 73c-4.5800565.0-7.4866309 1.5754274-11.5382193 6.1163653-1.6734822 1.8534441-1.598743 2.8514069-2.0391331 4.4738936C14.2318109 85.2127457 15.3810952 94.5991493 17.4068894 98.6767262 18.5085881 100.995054 18.5085881 100.995054 20.3179492 104.427606 20.9381193 105.604136 23.3268821 108.69306 24.5063492 109.790864c1.2349847 1.149478 2.6574201 2.834639 3.7432042 3.921533 1.1506404 1.15181600000001 4.2465085 3.084017 5.3028342 3.701814 1.4321645.837608000000003 2.774919 1.362015 4.0282636 1.573221C40.1349135 119.080104 41.2462694 118.670624 43.4146505 117.414211z" id="形状" fill="url(#linearGradient-1)"/><path d="M248.7 148.9C241 147.8 232.2 143 226.1 136.5c-14.2-15-20-43.1-12.1-58.6C216.6 72.9 223.2 67.5 228.5 66 235.2 64.1 249.3 65.1 255.7 67.9 258.6 69.2 261.4 70.8 262.1 71.6 263.7 73.5 265 79.9 263.9 80.6 263.4 80.9 260 79.6 256.3 77.8 243 71.3 230.4 73.3 225.1 82.9 218.5 94.9 223.7 119.3 235.5 131.5 245.8 142 257.4 142.9 271.3 134.2 273.7 132.7 274.2 132.7 275 134 275.5 134.8 276 137.2 276 139.2 276 142.2 275.5 143.2 272.8 144.8 266.2 148.7 257.7 150.2 248.7 148.9z" id="路径" fill="#fff"/><path d="M87.4 148.1C86.2 147.6 84.9 146.7 84.6 146.1 83.6 144.5 68.1 66.6 68.7 65.8c.599999999999994-1 7.5-1 9 0C78.4 66.3 80.6 74.4 82.5 83.9s3.7 17.6 4 18.2C87.5 103.6 96.3 103.1 99.9 101.2 105.7 98.3 107.2 95.2 110 79.7l2.5-14.2L117.3 65.2C123.5 64.8 123.7 65.7 121.6 78.4c-2.5 14.4-4.5 21.2-7.3 24.2C113 104 112 105.3 112.2 105.5 112.4 105.6 114.3 106.7 116.5 107.8 124.5 111.9 129.8 119.6 130.7 128.5 131.7 138 127.9 143.9 119 146.9 114.5 148.4 90.2 149.3 87.4 148.1zm24.9-9.5C117.8 136.3 119.3 133.8 118.8 127.7 117.9 117 111.3 112.1 96.6 111.2L87.7 110.7 88.3 113.1C88.6 114.4 89.8 120.5 91 126.5 92.1 132.6 93.3 138.1 93.5 138.8 94.1 140.5 108.1 140.4 112.3 138.6z" id="形状" fill="#fff"/><path d="M159.5 148.4C158.4 148.1 157.2 147.5 156.7 147.1c-1-1-16.8-80.2-16.1-81.2C141.2 64.8 148 64.7 149.7 65.8 150.3 66.2 152.2 73.3 153.8 81.5L156.7 96.5 167.8 97.1c17.1 1 25.5 5.7 31.2 17.2C206.2 129.1 202.4 143.6 190.5 146.9 186.1 148.1 162.6 149.2 159.5 148.4zm27.2-11C195 131.2 191.3 114.2 180.5 108.6 177.6 107.1 174.2 106.4 167.8 106.2 162.9 106 159 106.2 159 106.7 159 107.1 160.4 114.9 162.1 123.9L165.3 140.2 174.6 139.8C182.1 139.5 184.5 139 186.7 137.4z" id="形状" fill="#fff"/><path d="M52.3 50.7C49 41.2 49.5 37.5 52.9 46.5c1.2 3.1 1.9876864 5.9098389 2.1 6.3S55.4 54.1 55.9 54.9C56.6 56 58.2 55.2 63.5 50.9 67.2 47.9 70.4 45.6 70.6 45.8 71.7 46.5 70.9 47.4 64.1 53.2 60 56.6 58.2983882 57.6981689 57.4 58.2 56.5016118 58.7018311 56.5016118 58.7018311 55.8 58.2 55 57.49737 54 55.4 52.3 50.7z" id="形状" fill="#7e7e7e"/><path d="M84 34.1C84 30.6 82.8 29 80.4 29 78.9 29 78 28.4 78 27.5 78 26.7 78.9 26 80 26 82.4 26 82.4 25.5 80.5 17 79.7 13.4 79.1 8.4 79 5.8 79 1.6 79.3 1 81.4.4 85.1-.5 89.5.3 89.8 2 90 3.1 89.2 3.5 86.8 3.5 83.9 3.5 83.5 3.8 83.3 6.5 83.1 8.2 83.8 13.1 84.8 17.5c1.7 7.9 1.7 8 5.2 8.6L93.5 26.7C94.2848943 26.7875501 94.751561 26.9875501 94.9 27.3 95 28.6 94.2 29 91.1 29h-4L87.7 32.5C88.2 35.6 88 36 86.1 36 84.7 36 84 35.4 84 34.1z" id="形状" fill="url(#linearGradient-2)"/><path d="M105 34.1C105 30.6 103.8 29 101.4 29 99.9 29 99 28.4 99 27.5 99 26.7 99.9 26 101 26 103.4 26 103.4 25.5 101.5 17 100.7 13.4 100.1 8.4 1e2 5.8 1e2 1.6 100.3 1 102.4.4 106.1-.5 110.5.3 110.8 2 111 3.1 110.2 3.5 107.8 3.5 104.9 3.5 104.5 3.8 104.3 6.5 104.1 8.2 104.8 13.1 105.8 17.5c1.7 7.9 1.7 8 5.2 8.6L114.5 26.7C115.433333 26.8462934 115.9 27.0462934 115.9 27.3 116 28.6 115.2 29 112.1 29h-4L108.7 32.5C109.2 35.6 109 36 107.1 36 105.7 36 105 35.4 105 34.1z" id="形状" fill="url(#linearGradient-2)"/><path d="M54.3 26.9c-4.5-2.9-7.7-10-7.8-17.2C46.5 1.9 48.6.0 57.2.0 63.6.0 67 1.2 67 3.6 67 4.7 66.6 4.8 65.1 4c-2.7-1.4-10.4-1.3-12.4.3C51.8 4.9 51 6.6 50.9 8 50.4 13.5 50.6 13.7 57.8 14.2 66 14.9 69.5 16.4 71 20 72.3 23.2 71.2 26.3 68 28s-10.2 1.1-13.7-1.1zM67 22.7C67 19 63.6 17 57.3 17 54.4 17 52 17.3 52 17.8c0 1.1 3.1 5.4 5 7C57.9 25.5 60.2 25.9 62.8 25.7 65.1 25.4 67 26.1 67 22.7z" id="形状" fill="url(#linearGradient-3)"/><path d="M126.3 26.9c-4.5-2.9-7.7-10-7.8-17.2C118.5 1.9 120.6.0 129.2.0 135.6.0 139 1.2 139 3.6 139 4.7 138.6 4.8 137.1 4 134.4 2.6 126.7 2.7 124.7 4.3 123.8 4.9 123 6.6 122.9 8 122.4 13.5 122.6 13.7 129.8 14.2 138 14.9 141.5 16.4 143 20 144.3 23.2 143.2 26.3 140 28s-10.2 1.1-13.7-1.1zM139 22.7C139 19 135.6 17 129.3 17 126.4 17 124 17.3 124 17.8 124 18.9 127.1 23.2 129 24.8 129.9 25.5 132.2 25.9 134.8 25.7 137.1 25.4 139 26.1 139 22.7z" id="形状" fill="url(#linearGradient-3)"/><path d="M153.7 26.8C151.7 18.4 149.2978 2.90464869 149.2978 2.1 149.2978 1.77371339 148.894918.241544332 150.3.1 151.705082-.0415443324 153 .4 153 2.1 153 3.2 153.7 7.2 154.6 11 156.5 19.3 161 25.2 165.5 25.4 167.5 25.5 168.6 26.1 168.8 27.3 169.1 28.6 168.4 29 165.8 29 163.2 29 161.6 28.2 159.4 25.8L156.5 22.5C155.5 19.6333333 155.133333 18.4333333 155.4 18.9 155.9 19.7 156.5 22.2 156.7 24.6 156.9 27.9 156.7 29 155.6 29 154.8 29 154 28 153.7 26.8z" id="形状" fill="url(#linearGradient-4)"/></g></g></g></svg></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/apache/incubator-brpc/ target=_blank><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/zh/docs/><span class=active>文档</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/zh/docs/blogs/><span class=active>博客</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/docs/community/community/><span>社区</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/docs/faq/><span>FAQ</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/zh/docs/users/><span>用户</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002 搜索本站" aria-label=搜索本站 autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002 搜索本站" aria-label=搜索本站 autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav pt-2 pl-4" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/>English</a></div></div><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">文档</a></li><ul><li class="collapse show" id=zhdocs><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsoverview href=/zh/docs/overview/>简介</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsgetting_started href=/zh/docs/getting_started/>开始</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsbenchmark href=/zh/docs/benchmark/>性能基准</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bvar/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bvar</a></li><ul><li class=collapse id=zhdocsbvar><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bvar/bvar/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bvar</a></li><ul><li class=collapse id=zhdocsbvarbvar></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bvar/bvar-c++/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bvar c++</a></li><ul><li class=collapse id=zhdocsbvarbvar-c></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bvar/mbvar-c++/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">mbvar c++</a></li><ul><li class=collapse id=zhdocsbvarmbvar-c></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bthread/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread</a></li><ul><li class=collapse id=zhdocsbthread><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bthread/bthread/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread</a></li><ul><li class=collapse id=zhdocsbthreadbthread></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bthread/bthread-or-not/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread or not</a></li><ul><li class=collapse id=zhdocsbthreadbthread-or-not></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bthread/execution-queue/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Execution Queue</a></li><ul><li class=collapse id=zhdocsbthreadexecution-queue></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/bthread/thread-local/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">thread-local</a></li><ul><li class=collapse id=zhdocsbthreadthread-local></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">客户端</a></li><ul><li class=collapse id=zhdocsclient><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/basics/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">基础功能</a></li><ul><li class=collapse id=zhdocsclientbasics></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/error-code/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">错误码</a></li><ul><li class=collapse id=zhdocsclienterror-code></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/combo-channels/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">组合channels</a></li><ul><li class=collapse id=zhdocsclientcombo-channels></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/access-httph2/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">访问http:h2</a></li><ul><li class=collapse id=zhdocsclientaccess-httph2></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/access-grpc/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">访问gRPC</a></li><ul><li class=collapse id=zhdocsclientaccess-grpc></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/access-thrift/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">访问thrift</a></li><ul><li class=collapse id=zhdocsclientaccess-thrift></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/access-ub/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">访问UB</a></li><ul><li class=collapse id=zhdocsclientaccess-ub></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/access-redis/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">访问redis</a></li><ul><li class=collapse id=zhdocsclientaccess-redis></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/access-memcached/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">访问memcached</a></li><ul><li class=collapse id=zhdocsclientaccess-memcached></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/streaming-rpc/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">流式RPC</a></li><ul><li class=collapse id=zhdocsclientstreaming-rpc></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/backup-request/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Backup request</a></li><ul><li class=collapse id=zhdocsclientbackup-request></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/client/dummy-server/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Dummy server</a></li><ul><li class=collapse id=zhdocsclientdummy-server></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">服务端</a></li><ul><li class=collapse id=zhdocsserver><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/basics/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">基础功能</a></li><ul><li class=collapse id=zhdocsserverbasics></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/serve-httph2/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">搭建http:h2服务</a></li><ul><li class=collapse id=zhdocsserverserve-httph2></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/serve-grpc/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">搭建gRPC服务</a></li><ul><li class=collapse id=zhdocsserverserve-grpc></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/serve-thrift/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">搭建thrift服务</a></li><ul><li class=collapse id=zhdocsserverserve-thrift></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/serve-nshead/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">搭建Nshead服务</a></li><ul><li class=collapse id=zhdocsserverserve-nshead></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/server-push/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">推送</a></li><ul><li class=collapse id=zhdocsserverserver-push></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/debug-server-issues/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">高效率排查server卡顿</a></li><ul><li class=collapse id=zhdocsserverdebug-server-issues></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/avalanche/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">雪崩</a></li><ul><li class=collapse id=zhdocsserveravalanche></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/auto-concurrencylimiter/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">自适应限流</a></li><ul><li class=collapse id=zhdocsserverauto-concurrencylimiter></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/media-server/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">流媒体服务</a></li><ul><li class=collapse id=zhdocsservermedia-server></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/server/json2pb/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">json2pb</a></li><ul><li class=collapse id=zhdocsserverjson2pb></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">内置服务</a></li><ul><li class=collapse id=zhdocsbuiltin-services><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/buildin_services/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">builtin services</a></li><ul><li class=collapse id=zhdocsbuiltin-servicesbuildin_services></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/status/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">status</a></li><ul><li class=collapse id=zhdocsbuiltin-servicesstatus></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/vars/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">vars</a></li><ul><li class=collapse id=zhdocsbuiltin-servicesvars></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/connections/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">connections</a></li><ul><li class=collapse id=zhdocsbuiltin-servicesconnections></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/flags/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">flags</a></li><ul><li class=collapse id=zhdocsbuiltin-servicesflags></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/rpcz/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpcz</a></li><ul><li class=collapse id=zhdocsbuiltin-servicesrpcz></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/cpu_profiler/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">cpu profiler</a></li><ul><li class=collapse id=zhdocsbuiltin-servicescpu_profiler></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/heap_profiler/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">heap profiler</a></li><ul><li class=collapse id=zhdocsbuiltin-servicesheap_profiler></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/builtin-services/contention_profiler/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">contention profiler</a></li><ul><li class=collapse id=zhdocsbuiltin-servicescontention_profiler></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/tools/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">工具</a></li><ul><li class=collapse id=zhdocstools><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/tools/rpc_press/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpc_press</a></li><ul><li class=collapse id=zhdocstoolsrpc_press></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/tools/rpc_replay/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpc_replay</a></li><ul><li class=collapse id=zhdocstoolsrpc_replay></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/tools/rpc_view/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">rpc_view</a></li><ul><li class=collapse id=zhdocstoolsrpc_view></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/tools/benchmark_http/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">benchmark_http</a></li><ul><li class=collapse id=zhdocstoolsbenchmark_http></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/tools/parallel_http/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">parallel_http</a></li><ul><li class=collapse id=zhdocstoolsparallel_http></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/c++-base/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">C++基础</a></li><ul><li class=collapse id=zhdocsc-base><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/c++-base/iobuf/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">IOBuf</a></li><ul><li class=collapse id=zhdocsc-baseiobuf></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/c++-base/streaming-log/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Streaming Log</a></li><ul><li class=collapse id=zhdocsc-basestreaming-log></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/c++-base/flatmap/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">FlatMap</a></li><ul><li class=collapse id=zhdocsc-baseflatmap></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/c++-base/brpc-training-materials/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bRPC培训材料</a></li><ul><li class=collapse id=zhdocsc-basebrpc-training-materials></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">深入RPC</a></li><ul><li class=collapse id=zhdocsrpc-in-depth><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/new-protocol/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">支持新协议</a></li><ul><li class=collapse id=zhdocsrpc-in-depthnew-protocol></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/atomic-instructions/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">原子指令</a></li><ul><li class=collapse id=zhdocsrpc-in-depthatomic-instructions></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/io/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">IO</a></li><ul><li class=collapse id=zhdocsrpc-in-depthio></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/threading-overview/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">线程模型简介</a></li><ul><li class=collapse id=zhdocsrpc-in-depththreading-overview></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/load-balancing/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">负载均衡</a></li><ul><li class=collapse id=zhdocsrpc-in-depthload-balancing></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/locality-aware/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Locality-aware</a></li><ul><li class=collapse id=zhdocsrpc-in-depthlocality-aware></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/consistent-hashing/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">一致性哈希</a></li><ul><li class=collapse id=zhdocsrpc-in-depthconsistent-hashing></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/memory-management/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">内存管理</a></li><ul><li class=collapse id=zhdocsrpc-in-depthmemory-management></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/timer-keeping/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">Timer keeping</a></li><ul><li class=collapse id=zhdocsrpc-in-depthtimer-keeping></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/rpc-in-depth/bthread_id/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bthread_id</a></li><ul><li class=collapse id=zhdocsrpc-in-depthbthread_id></li></ul></ul></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/use-cases-inside-baidu/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">bRPC在百度内部的应用</a></li><ul><li class=collapse id=zhdocsuse-cases-inside-baidu><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/use-cases-inside-baidu/use-case1/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">百度地图api入口</a></li><ul><li class=collapse id=zhdocsuse-cases-inside-baiduuse-case1></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/use-cases-inside-baidu/use-case2/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">联盟DSP</a></li><ul><li class=collapse id=zhdocsuse-cases-inside-baiduuse-case2></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/use-cases-inside-baidu/use-case3/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">ELF学习框架</a></li><ul><li class=collapse id=zhdocsuse-cases-inside-baiduuse-case3></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/use-cases-inside-baidu/use-case4/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">云平台代理服务</a></li><ul><li class=collapse id=zhdocsuse-cases-inside-baiduuse-case4></li></ul></ul></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsdownloadbrpc href=/zh/docs/downloadbrpc/>下载bRPC</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/community/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">社区</a></li><ul><li class=collapse id=zhdocscommunity><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocscommunitycommunity href=/zh/docs/community/community/>社区</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocscommunitycontributing href=/zh/docs/community/contributing/>Contribute指南</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocscommunitycommitter href=/zh/docs/community/committer/>Committer指南</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocscommunityrelease href=/zh/docs/community/release/>Release指南</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocscommunitysecurity href=/zh/docs/community/security/>安全</a></li></ul></ul><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsfaq href=/zh/docs/faq/>FAQ</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsusers href=/zh/docs/users/>用户</a><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/blogs/ class="align-left pl-0 pr-2 td-sidebar-link td-sidebar-link__section">博客</a></li><ul><li class="collapse show" id=zhdocsblogs><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/blogs/releases/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">版本发布</a></li><ul><li class=collapse id=zhdocsblogsreleases><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsblogsreleases130 href=/zh/docs/blogs/releases/1.3.0/>bRPC 1.3.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsblogsreleases120 href=/zh/docs/blogs/releases/1.2.0/>bRPC 1.2.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsblogsreleases110 href=/zh/docs/blogs/releases/1.1.0/>bRPC 1.1.0</a>
<a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsblogsreleases100 href=/zh/docs/blogs/releases/1.0.0/>bRPC 1.0.0</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/blogs/shares/ class="align-left pl-0 pr-2 active td-sidebar-link td-sidebar-link__section">分享</a></li><ul><li class="collapse show" id=zhdocsblogsshares><a class="td-sidebar-link td-sidebar-link__page active" id=m-zhdocsblogssharesbrpc-guide-for-beginners href=/zh/docs/blogs/shares/brpc-guide-for-beginners/>brpc初学者指南</a></li></ul></ul><ul class="td-sidebar-nav__section pr-md-3"><li class=td-sidebar-nav__section-title><a href=/zh/docs/blogs/sourcecodes/ class="align-left pl-0 pr-2 collapsed td-sidebar-link td-sidebar-link__section">源码解析</a></li><ul><li class=collapse id=zhdocsblogssourcecodes><a class="td-sidebar-link td-sidebar-link__page" id=m-zhdocsblogssourcecodesbthread href=/zh/docs/blogs/sourcecodes/bthread/>bRPC源码解析·bthread机制</a></li></ul></ul></li></ul></ul></li></ul></ul></nav></div></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/apache/incubator-brpc-website/edit/master/content/zh/docs/blogs/shares/brpc%20guide%20for%20beginners/index.md target=_blank><i class="fa fa-edit fa-fw"></i> 编辑本页</a>
<a href="https://github.com/apache/incubator-brpc-website/issues/new?title=brpc%e5%88%9d%e5%ad%a6%e8%80%85%e6%8c%87%e5%8d%97" target=_blank><i class="fab fa-github fa-fw"></i> 创建文档 issue</a>
<a href=https://github.com/apache/incubator-brpc/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> 创建项目 issue</a></div><nav id=TableOfContents><ul><li><a href=#文档>文档</a></li><li><a href=#源码>源码</a><ul><li><a href=#客户端>客户端</a></li><li><a href=#服务端>服务端</a></li><li><a href=#源码目录>源码目录</a></li></ul></li><li><a href=#实践>实践</a><ul><li><a href=#issue>Issue</a></li><li><a href=#pr>PR</a></li></ul></li><li><a href=#结语>结语</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class="d-none d-md-block d-print-none"><ol class="breadcrumb spb-1"><li class=breadcrumb-item><a href=/zh/zh/docs/>文档</a></li><li class=breadcrumb-item><a href=/zh/zh/docs/blogs/>博客</a></li><li class=breadcrumb-item><a href=/zh/zh/docs/blogs/shares/>分享</a></li><li class="breadcrumb-item active" aria-current=page><a href=/zh/zh/docs/blogs/shares/brpc-guide-for-beginners/>brpc初学者指南</a></li></ol></nav><div class=td-content><h1>brpc初学者指南</h1><p>(作者简介：lorinlee，是brpc新进committer，在字节跳动负责图数据库相关工作）</p><p>Apache brpc(incubating) 是一款优秀的工业级 C++ RPC 框架，其兼具高性能、兼容多种协议、周边工具完善等多种优点于一身，已在国内多个大厂广泛使用。</p><p>有不少同学对brpc感兴趣，但还没有找到合适的路径，不知道如何学习。笔者是来自字节跳动的研发工程师，也曾遇到相同的困扰，后来通过自己的一些摸索，成为了brpc committer，期间也总结了一些经验，希望对大家有所帮助。</p><p>因此本文期望结合作者的经历，通过一些简单可行的步骤，帮助大家迈出探索brpc的脚步，学习它的设计与实现方式，以对大家日常的学习和工作有所帮助。也欢迎大家在熟悉brpc之后，参与到brpc的贡献中，比如文档完善、解决issue、bugfix、feature开发等等。</p><h2 id=文档>文档</h2><p>初始接触brpc，文档是最好的入手材料。brpc的文档在国内开源项目中广受赞誉，原因是其不仅介绍了丰富的技术知识，还蕴含了设计者深入的思考与选择。</p><p>首先推荐阅读：<a href=https://brpc.apache.org/docs/overview/>bRPC Overview</a>，这篇文档不仅综述性地介绍了brpc，它更是一篇索引，关键的技术都有超链接至对应的细节文档，阅读完这篇文档以及所有的链接，将能够对brpc有完整的认识。</p><p>另外，有些文档虽然在上面链接中已经涵盖了，但我依然想在这里再单独分类推荐一下：</p><ol><li><p>IO：RPC框架作为网络通信框架，IO模型是非常重要的一环，其定义了客户端如何发送消息，服务端如何接受消息，这篇文档详细介绍了brpc对于这一过程的实现。常见的RPC框架会区分IO线程和Worker线程，但这样的设计是有弊端的。brpc则不对线程做区分，IO逻辑和业务逻辑全都在bthread中，通过调度器平衡任务在线程之间的负载。另外，brpc支持多种协议，并支持灵活的拓展，可以参考 protocol。</p></li><li><p>线程模型，bthread：RPC框架另一个重要的部分是线程模型，brpc自研了用户态调度的M:N线程库bthread，既能达到优异的性能，又不会损失代码的可维护性。</p></li><li><p>bthread_id：这里的bthread_id并不是bthread本身的id（bthread_t），而是用于对同一个request的多次重试、超时处理等并发事件进行同步，以及在连接复用（单连接）的场景，维护request和response的映射。</p></li><li><p>IOBuf：RPC框架需要处理大量接收的消息、发送的消息，其中消息占用的内存分配在很多场景都可能会成为一大开销，brpc通过IOBuf减少内存分配、拷贝等开销。</p></li><li><p>Timer：RPC场景需要处理大量的时间事件，主要是对于超时的控制，比如对于一个请求，需要在其超时后及时终止并结束。一般的系统在吞吐上升的过程中，Timer的压力会不断增加，其拓展性会成为性能瓶颈。而brpc对Timer做了细致的设计，使timer操作几乎对RPC性能没有影响。</p></li><li><p>MemoryManagement：brpc实现了内存池对一些对象进行管理以提升性能，并且可以对这些对象附加version，简化了共享对象的回收逻辑。</p></li><li><p>bvar：系统服务通常需要采集大量的指标，用于系统监控、性能优化等，但通常大量的指标采集会严重影响性能，有些做法是通过采样来降低开销，但会导致指标不够准确。brpc的bvar则能够高效的收集大量指标。</p></li></ol><h2 id=源码>源码</h2><p>文档能够快速了解系统的核心设计思路，但如果要深入理解系统，还是需要对源码进行阅读。brpc是一款优秀的C++项目，其源码是值得大家阅读学习的。这里简单为大家把源码进行一些介绍，方便大家阅读。</p><p>整体的源码阅读过程，推荐先按照某些关键的执行流程来阅读，梳理其中的各个环节步骤，就能够理解每个模块在整个系统所处的位置；随后单独对重要的模块研读其实现，就能够比较好地掌握整个系统。</p><p>RPC框架一般会用在两个端，客户端和服务端，两者有些流程是共用的，有些是不同的。所以可以将简单的echo服务为出发点，分别对客户端和服务端的流程进行阅读。</p><h3 id=客户端>客户端</h3><p>对于客户端，典型的流程比如：客户端的初始化，发起RPC请求，处理应答，以及处理超时等逻辑。这里对一些关键的过程进行简述，大家可以在阅读过程中搜寻下述的一些关键函数名，找到代码对应的位置：</p><ol><li><p>客户端的初始化：Channel::Init，这里会做全局的初始化（GlobalInitializeOrDie），NamingService线程、LoadBalancer的初始化等。</p></li><li><p>发起RPC请求：Channel::CallMethod，这里会分配call_id（bthread_id），序列化请求内容（_serialize_request -> Protocol::SerializeRequest），注册BackupRequest/Timeout的事件，选择要发送消息的Socket，打包协议内容（_pack_request -> Protocol::PackRequest），消息写入fd（Socket::Write）。</p></li><li><p>处理应答：客户端在创建Socket时，会将对应的fd放在EventDispatcher中，并注册对应的回调函数（InputMessenger::OnNewMessages）。在Linux系统下，当fd有可读数据，EventDispatcher::Run中会通过epoll_wait拿到对应fd，调用Socket::StartInputEvent，并最终回调至InputMessenger::OnNewMessages。在InputMessenger::OnNewMessages中，会从fd中读取数据，按请求粒度切分数据，并将每个请求通过协议定义的处理函数中进行执行（Protocol::ProcessResponse），并最终调用至Controller::OnVersionedRPCReturned结束RPC，或执行重试等。</p></li><li><p>处理超时：超时事件是注册在Timer线程中的，在RPC超时后，Timer线程会回调HandleTimeout，并经由bthread_id的机制回调至Controller::HandleSocketFailed，最终也会到达Controller::OnVersionedRPCReturned，在这里结束RPC或执行重试等。</p></li></ol><h3 id=服务端>服务端</h3><p>对于服务端，典型的流程包括：服务的启动，收到RPC请求，执行处理，返回应答等逻辑。这里也对一些关键的过程进行简述，方便大家找到对应的代码位置：</p><ol><li><p>服务启动：Server::Start，这里会做一些初始化（Server::InitializeOnce），数据存储工厂初始化（SessionData，ThreadLocalData，bthread_local），创建Acceptor用于接受客户端连接。</p></li><li><p>收到RPC请求：服务端收到的请求也是通过EventDispatcher进行派发的。在收到客户端连接请求时，EventDispatcher会回调Acceptor::OnNewConnections进行新连接建立，并将新连接也托管至EventDispatcher。在连接收到数据后，会由EventDispatcher回调至InputMessenger::OnNewMessages，从fd中读取数据，对数据按请求粒度进行切分，并调用协议中注册的处理函数（Protocol::ProcessRequest）进行处理。（客户端和服务端在这里注册的回调是不同的）。</p></li><li><p>执行处理：请求的处理逻辑与协议有关，不过大体的逻辑是相似的，这里以baidu_std协议为例简述一下处理流程。baidu_std协议的请求处理逻辑在ProcessRpcRequest中，其会设置一些上下文信息，并发控制与限流，反序列化协议头和元数据，根据元数据找到具体的请求信息，反序列化请求体，注册RPC结束（done->Run()）的回调函数（SendRpcResponse），并调用用户注册的Service对应方法进行处理。</p></li><li><p>返回应答：在用户处理函数处理结束后，通常会调用done->Run()结束RPC，此时会回调上面注册的函数SendRpcResponse，将用户写好的Response，连同协议头和元数据一起序列化，写入fd中。</p></li></ol><h3 id=源码目录>源码目录</h3><p>这里再对brpc的源码目录做个基本的介绍，方便大家有个整体认识。首先推荐大家阅读brpc中的示例，其能够帮助大家对brpc的使用场景和使用方法有所了解，并在后续对核心系统源码阅读的过程能够带着使用场景阅读。</p><p>example目录下，主要有几个目录：</p><ol><li><p>echo_c++：同步客户端的echo示例</p></li><li><p>asynchronous_echo_c++：异步客户端的echo示例</p></li><li><p>backup_request_c++：客户端开启backup_request示例</p></li><li><p>cancel_c++：客户端取消rpc示例</p></li><li><p>parallel_echo_c++：客户端同时访问多个服务示例</p></li><li><p>partition_echo_c++：客户端分区调用的示例</p></li><li><p>dynamic_partition_echo_c++：客户端动态分区调用的示例</p></li><li><p>selective_echo_c++：客户端多Channel间负载均衡示例</p></li><li><p>multi_threaded_echo_c++：客户端多线程echo示例</p></li><li><p>multi_threaded_echo_fns_c++：客户端多线程+服务端多server示例</p></li><li><p>auto_concurrency_limiter：服务端开启自适应限流并验证其有效性</p></li><li><p>cascade_echo_c++：服务端级联调用示例</p></li><li><p>session_data_and_thread_local：服务端使用SessionData和ThreadLocalData</p></li><li><p>grpc_c++：grpc协议示例</p></li><li><p>http_c++：http协议示例</p></li><li><p>memcache_c++：memcache客户端示例</p></li><li><p>redis_c++：redis协议示例</p></li><li><p>thrift_extension_c++：thrift协议示例</p></li><li><p>streaming_echo_c++：大块数据传输示例</p></li></ol><p>而brpc系统核心的实现在src目录中，其主要有几个目录：</p><ol><li><p>brpc<br>brpc目录下主要是RPC框架的实现，内容相对比较多，涵盖了网络通信框架、支持的各种协议、builtin服务等，以及包括负载均衡、服务发现、限流等。</p></li><li><p>bthread<br>bthread目录下主要是用户态调度的M:N线程库的实现。其中包括bthread调度器、bthread同步原语、timer线程等。</p></li><li><p>butil<br>butil目录下是丰富的工具库，包括了对文件、网络、时间、线程、内存、字符串、日志、容器等等各种基础组件的封装，以及一些第三方库。</p></li><li><p>bvar<br>bvar目录下是指标收集的实现。</p></li></ol><h2 id=实践>实践</h2><p>俗话说：“纸上得来终觉浅，绝知此事要躬行”。在对源码有一定的阅读之后，就推荐大家具体地解决一些问题，这样能够对系统可以有更好地理解。</p><h3 id=issue>Issue</h3><p>首先可以解决github issue。brpc有很多的用户，用户会在使用过程中遇到不同的问题，并发布在github issue中。通过对这些issue的解答，不仅能够加深对系统的认识，并且能够帮助到其他人，是一件非常有意义的事情。</p><p>当然，大家在使用过程中遇到的问题，也欢迎提在issue中，比如对系统改进的一些想法、发现的一些bug等。issue对比群聊的好处在于之前的问题可以追溯，同样的问题讨论一遍之后便会有完整的记录，如果后来的人遇到类似的问题，可以直接查阅前面的issue自行解决。</p><p>此外，之前的issue中对一些问题的讨论，也是非常好的学习材料。其中有些issue依然没有结论，期待着大家参与交流。</p><p>brpc社区有很多的issue，对于issue的管理，会给一些issue打上对应的lebel，目前label的类型有如下几种：</p><ol><li><p>bug：确认为bug的问题</p></li><li><p>discussion：讨论</p></li><li><p>enhancement：待改进的问题，需要优化</p></li><li><p>feature：新特性，需要开发</p></li><li><p>good first issue：适合brpc初学者解决的问题</p></li><li><p>help wanted：适合对brpc有一些了解的同学解决的问题</p></li><li><p>official：由brpc官方提出的问题</p></li><li><p>regression：兼容性问题</p></li><li><p>security：安全性问题</p></li><li><p>wontfix：不再修复的问题</p></li></ol><p>初学的同学可以选择 &ldquo;good first issue&rdquo; 中的问题进行解决，以及 &ldquo;help wanted&rdquo; 中的也可以尝试。</p><h3 id=pr>PR</h3><p>另外的实践方式就是提PR了。任何对项目有益的PR，不论它改进程度的大小，都是非常好的。可做的比如编写/翻译文档、修复bug、开发feature、代码重构、性能优化、修复typo等等。</p><p>通过提PR，大家会实际动手参与到brpc的建设中，会对系统有更好地理解，并且会更广泛地帮助到所有使用brpc的用户；而brpc项目也会因大家的贡献而一点点进步。</p><p>如果想提PR，但对做什么有些迷茫，可以参考一些label下的issue，比如 &ldquo;good first issue&rdquo;，&ldquo;help wanted&rdquo; 等，都比较适合初学者。当慢慢熟悉后，可以尝试解决 &ldquo;enhancement&rdquo;，&ldquo;official&rdquo;，&ldquo;feature&rdquo;，&ldquo;bug&rdquo; 等label下的问题。</p><h2 id=结语>结语</h2><p>brpc是一个优秀的C++项目，值得大家学习它的设计与实现。但brpc同时也是相对有些复杂的项目，其有13w+行代码，需要一定的学习过程。</p><p>本文推荐了大家一些学习的入手点，希望能帮助大家更好地入门，并在学习过程中有丰厚的收获。当然，也期待大家在熟悉brpc之后，能够参与到brpc的贡献中，帮助到大量brpc的使用者。</p><div class="text-muted mt-5 pt-3 border-top">修改于 2022年10月31日: <a href=https://github.com/apache/incubator-brpc-website/commit/b5f9123dc50a1762c4848d9db55f1ad7de4ea070>optimize the format of the release guide page (#108) (b5f9123)</a></div></div></main></div></div><footer class="bg-dark py-5 row d-print-none" style=display:flex;align-items:center;padding:0!important><div class="container-fluid mx-sm-5"><div class=row style=display:flex;align-items:center><div class="col-12 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank href=https://github.com/apache/incubator-brpc><i class="fab fa-github"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 The Apache Software Foundation. Apache and the Apache feather logo are trademarks of The Apache Software Foundation. 保留所有权利</small><div style=font-size:12.8px;color:#757474><a href=https://www.apache.org/ target=_blank rel=noopener>Foundation</a> |
<a href=https://www.apache.org/licenses/ target=_blank rel=noopener>License</a> |
<a href=https://www.apache.org/security/ target=_blank rel=noopener>Security</a> |
<a href=https://www.apache.org/events/current-event target=_blank rel=noopener>Events</a> |
<a href=https://www.apache.org/foundation/sponsorship.html target=_blank rel=noopener>Sponsorship</a> |
<a href=https://privacy.apache.org/policies/privacy-policy-public.html target=_blank rel=noopener>Privacy</a> |
<a href=https://www.apache.org/foundation/thanks.html target=_blank rel=noopener>Thanks</a></div></div></div></div></footer></div><script src=https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js integrity=sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49 crossorigin=anonymous></script>
<script src=https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js integrity=sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy crossorigin=anonymous></script>
<script src=/js/main.min.9d50ef1e20df1eedd2ae2eb4cada72195e39f38e910f839ca9df5402c80b9695.js integrity="sha256-nVDvHiDfHu3Sri60ytpyGV45846RD4Ocqd9UAsgLlpU=" crossorigin=anonymous></script></body></html>